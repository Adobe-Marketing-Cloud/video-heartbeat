/*
 * ************************************************************************
 *
 *  ADOBE CONFIDENTIAL
 *  ___________________
 *
 *   (c) Copyright 2014 Adobe Systems Incorporated
 *   All Rights Reserved.
 *
 *  NOTICE:  All information contained herein is, and remains
 *  the property of Adobe Systems Incorporated and its suppliers,
 *  if any.  The intellectual and technical concepts contained
 *  herein are proprietary to Adobe Systems Incorporated and its
 *  suppliers and may be covered by U.S. and Foreign Patents,
 *  patents in process, and are protected by trade secret or copyright law.
 *  Dissemination of this information or reproduction of this material
 *  is strictly forbidden unless prior written permission is obtained
 *  from Adobe Systems Incorporated.
 * ************************************************************************
 */

/*
 * video heartbeats - v1.4.0 - 2014-10-23
 * Copyright (c) 2014 Adobe Systems, Inc. All Rights Reserved.
 */
 !function(a){!function(a,b,c){"use strict";function d(a){if(d.__super__.constructor.call(this,j),!a){var b="The reference to the player delegate implementation cannot be NULL.";this.error(this+" "+b)}this._appMeasurement=a,this._workQueue=new e(!0,z),this._inputDataSanitizer=new g(this._onInvalidInputData,this)}var e=a.radio.CommandQueue,f=a.radio.Command,g=a.InputDataSanitizer,h=c.md5,i=a.plugin.BasePlugin;a.extend(d,i);var j="adobe-analytics",k="player",l="config",m="video_start",n="ad_start",o="video_info",p="ad_break_info",q="ad_info",r="channel",s="is_primetime",t="rsid",u="tracking_server",v="use_ssl",w="visitor_id",x="analytics_visitor_id",y="marketing_cloud_visitor_id",z=2e3,A="video",B="videoAd",C="ms_s",D="msp_s",E="msa_s",F="mspa_s";d.prototype.bootstrap=function(a){d.__super__.bootstrap.call(this,a),this._pluginManager.on(k,m,this._onPlayerVideoStart,this),this._pluginManager.on(k,n,this._onPlayerAdStart,this);var b={};b[t]="account",b[u]="trackingServer",b[v]="ssl",b[w]="visitorID",b[x]="analyticsVisitorID",b[y]="marketingCloudVisitorID",this._dataResolver=function(a){return this._isEnabled?this._appMeasurement[b[a]]:null},this._prepareAppMeasurement()},d.prototype.setup=function(){},d.prototype._teardown=function(){this._pluginManager.off(k,m,this._onPlayerVideoStart,this),this._pluginManager.off(k,n,this._onPlayerAdStart,this)},d.prototype._onPlayerVideoStart=function(){this._enqueueCall("aa.open",this._executeAdobeAnalyticsOpen)},d.prototype._onPlayerAdStart=function(){this._enqueueCall("aa.openAd",this._executeAdobeAnalyticsOpenAd)},d.prototype._resetAppMeasurementContextData=function(){delete this._appMeasurement.contextData["a.contentType"],delete this._appMeasurement.contextData["a.media.name"],delete this._appMeasurement.contextData["a.media.friendlyName"],delete this._appMeasurement.contextData["a.media.length"],delete this._appMeasurement.contextData["a.media.playerName"],delete this._appMeasurement.contextData["a.media.channel"],delete this._appMeasurement.contextData["a.media.view"],delete this._appMeasurement.contextData["a.media.ad.name"],delete this._appMeasurement.contextData["a.media.ad.friendlyName"],delete this._appMeasurement.contextData["a.media.ad.podFriendlyName"],delete this._appMeasurement.contextData["a.media.ad.length"],delete this._appMeasurement.contextData["a.media.ad.playerName"],delete this._appMeasurement.contextData["a.media.ad.pod"],delete this._appMeasurement.contextData["a.media.ad.podPosition"],delete this._appMeasurement.contextData["a.media.ad.podSecond"],delete this._appMeasurement.contextData["a.media.ad.CPM"],delete this._appMeasurement.contextData["a.media.ad.view"]},d.prototype._enqueueCall=function(a,b,c){this._isInitialized&&this._workQueue.isEmpty()?b.apply(this,c):(this.log("#_enqueueCall() : "+a),this._workQueue.addCommand(new f(b,this,c)))},d.prototype._executeAdobeAnalyticsOpen=function(){if(this._canProcess()){var a=this._pluginManager.request(k,o);this._inputDataSanitizer.sanitizeVideoInfo(a)&&(this.log("#_executeAdobeAnalyticsOpen(id="+a.id+", length="+a.length+", streamType="+a.streamType+", playerName="+a.playerName+")"),this._resetAppMeasurementContextData(),this._appMeasurement.contextData["a.contentType"]=A,this._appMeasurement.contextData["a.media.name"]=a.id,this._appMeasurement.contextData["a.media.friendlyName"]=a.name||"",this._appMeasurement.contextData["a.media.length"]=Math.floor(a.length)||"0.0",this._appMeasurement.contextData["a.media.playerName"]=a.playerName,this._appMeasurement.contextData["a.media.channel"]=this._pluginManager.request(l,r),this._appMeasurement.contextData["a.media.view"]=!0,this._appMeasurement.pev3=A,this._appMeasurement.pe=this._pluginManager.request(l,s)?D:C,this._appMeasurement.track())}},d.prototype._executeAdobeAnalyticsOpenAd=function(){if(this._canProcess()){var a=this._pluginManager.request(k,o);if(this._inputDataSanitizer.sanitizeVideoInfo(a)){var b=this._pluginManager.request(k,p);if(this._inputDataSanitizer.sanitizeAdBreakInfo(b)){var c=this._pluginManager.request(k,q);if(this._inputDataSanitizer.sanitizeAdInfo(c)){var d=h(a.id)+"_"+b.position;this.log("#_executeAdobeAnalyticsOpenAd(id="+c.id+", length="+c.length+", playerName="+b.playerName+", parentId="+a.id+", podId="+d+", parentPodPosition="+c.position+", podSecond="+b.startTime+", cpm="+c.cpm+")"),this._resetAppMeasurementContextData(),this._appMeasurement.contextData["a.contentType"]=B,this._appMeasurement.contextData["a.media.name"]=a.id,this._appMeasurement.contextData["a.media.channel"]=this._pluginManager.request(l,r),this._appMeasurement.contextData["a.media.ad.name"]=c.id,this._appMeasurement.contextData["a.media.ad.friendlyName"]=c.name||"",this._appMeasurement.contextData["a.media.ad.podFriendlyName"]=b.name||"",this._appMeasurement.contextData["a.media.ad.length"]=Math.floor(c.length)||"0.0",this._appMeasurement.contextData["a.media.ad.playerName"]=b.playerName,this._appMeasurement.contextData["a.media.ad.pod"]=d,this._appMeasurement.contextData["a.media.ad.podPosition"]=Math.floor(c.position)||"0.0",this._appMeasurement.contextData["a.media.ad.podSecond"]=Math.floor(b.startTime)||"0.0",this._appMeasurement.contextData["a.media.ad.CPM"]=c.cpm,this._appMeasurement.contextData["a.media.ad.view"]=!0,this._appMeasurement.pev3=B,this._appMeasurement.pe=this._pluginManager.request(l,s)?F:E,this._appMeasurement.track()}}}}},d.prototype._prepareAppMeasurement=function(){this._appMeasurement.isReadyToTrack()?this._onAppMeasurementReady():this._appMeasurement.callbackWhenReadyToTrack(this,this._onAppMeasurementReady)},d.prototype._onAppMeasurementReady=function(){return this._pluginManager.request(i.STATE_PLUGIN,i.ERROR_INFO)?(this.log("#_onAppMeasurementReady() > Unable to track: in ERROR state."),void this._workQueue.cancelAllCommands()):(this._workQueue.resume(),void d.__super__.setup.call(this))},b.AdobeAnalyticsPlugin=d}(a.ADB.core,a.ADB.va.plugins,a.ADB.va.utils)}(this);
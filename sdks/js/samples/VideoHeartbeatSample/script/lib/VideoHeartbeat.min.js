/*
 * ************************************************************************
 *
 *  ADOBE CONFIDENTIAL
 *  ___________________
 *
 *   (c) Copyright 2014 Adobe Systems Incorporated
 *   All Rights Reserved.
 *
 *  NOTICE:  All information contained herein is, and remains
 *  the property of Adobe Systems Incorporated and its suppliers,
 *  if any.  The intellectual and technical concepts contained
 *  herein are proprietary to Adobe Systems Incorporated and its
 *  suppliers and may be covered by U.S. and Foreign Patents,
 *  patents in process, and are protected by trade secret or copyright law.
 *  Dissemination of this information or reproduction of this material
 *  is strictly forbidden unless prior written permission is obtained
 *  from Adobe Systems Incorporated.
 * ************************************************************************
 */

/*
 * video heartbeats - v1.2.0 - 2014-07-17
 * Copyright (c) 2014 Adobe Systems, Inc. All Rights Reserved.
 */
 (function(t){if(e===void 0)var e={};if(i===void 0)var i={};if(a===void 0)var a={};if(n===void 0)var n={};n.event||(n.event={}),n.model||(n.model={}),n.context||(n.context={}),n.network||(n.network={}),n.clock||(n.clock={}),function(t){"use strict";function e(t,e){var i=(65535&t)+(65535&e),a=(t>>16)+(e>>16)+(i>>16);return a<<16|65535&i}function i(t,e){return t<<e|t>>>32-e}function a(t,a,n,s,r,o){return e(i(e(e(a,t),e(s,o)),r),n)}function n(t,e,i,n,s,r,o){return a(e&i|~e&n,t,e,s,r,o)}function s(t,e,i,n,s,r,o){return a(e&n|i&~n,t,e,s,r,o)}function r(t,e,i,n,s,r,o){return a(e^i^n,t,e,s,r,o)}function o(t,e,i,n,s,r,o){return a(i^(e|~n),t,e,s,r,o)}function h(t,i){t[i>>5]|=128<<i%32,t[(i+64>>>9<<4)+14]=i;var a,h,_,c,l,p=1732584193,u=-271733879,d=-1732584194,m=271733878;for(a=0;t.length>a;a+=16)h=p,_=u,c=d,l=m,p=n(p,u,d,m,t[a],7,-680876936),m=n(m,p,u,d,t[a+1],12,-389564586),d=n(d,m,p,u,t[a+2],17,606105819),u=n(u,d,m,p,t[a+3],22,-1044525330),p=n(p,u,d,m,t[a+4],7,-176418897),m=n(m,p,u,d,t[a+5],12,1200080426),d=n(d,m,p,u,t[a+6],17,-1473231341),u=n(u,d,m,p,t[a+7],22,-45705983),p=n(p,u,d,m,t[a+8],7,1770035416),m=n(m,p,u,d,t[a+9],12,-1958414417),d=n(d,m,p,u,t[a+10],17,-42063),u=n(u,d,m,p,t[a+11],22,-1990404162),p=n(p,u,d,m,t[a+12],7,1804603682),m=n(m,p,u,d,t[a+13],12,-40341101),d=n(d,m,p,u,t[a+14],17,-1502002290),u=n(u,d,m,p,t[a+15],22,1236535329),p=s(p,u,d,m,t[a+1],5,-165796510),m=s(m,p,u,d,t[a+6],9,-1069501632),d=s(d,m,p,u,t[a+11],14,643717713),u=s(u,d,m,p,t[a],20,-373897302),p=s(p,u,d,m,t[a+5],5,-701558691),m=s(m,p,u,d,t[a+10],9,38016083),d=s(d,m,p,u,t[a+15],14,-660478335),u=s(u,d,m,p,t[a+4],20,-405537848),p=s(p,u,d,m,t[a+9],5,568446438),m=s(m,p,u,d,t[a+14],9,-1019803690),d=s(d,m,p,u,t[a+3],14,-187363961),u=s(u,d,m,p,t[a+8],20,1163531501),p=s(p,u,d,m,t[a+13],5,-1444681467),m=s(m,p,u,d,t[a+2],9,-51403784),d=s(d,m,p,u,t[a+7],14,1735328473),u=s(u,d,m,p,t[a+12],20,-1926607734),p=r(p,u,d,m,t[a+5],4,-378558),m=r(m,p,u,d,t[a+8],11,-2022574463),d=r(d,m,p,u,t[a+11],16,1839030562),u=r(u,d,m,p,t[a+14],23,-35309556),p=r(p,u,d,m,t[a+1],4,-1530992060),m=r(m,p,u,d,t[a+4],11,1272893353),d=r(d,m,p,u,t[a+7],16,-155497632),u=r(u,d,m,p,t[a+10],23,-1094730640),p=r(p,u,d,m,t[a+13],4,681279174),m=r(m,p,u,d,t[a],11,-358537222),d=r(d,m,p,u,t[a+3],16,-722521979),u=r(u,d,m,p,t[a+6],23,76029189),p=r(p,u,d,m,t[a+9],4,-640364487),m=r(m,p,u,d,t[a+12],11,-421815835),d=r(d,m,p,u,t[a+15],16,530742520),u=r(u,d,m,p,t[a+2],23,-995338651),p=o(p,u,d,m,t[a],6,-198630844),m=o(m,p,u,d,t[a+7],10,1126891415),d=o(d,m,p,u,t[a+14],15,-1416354905),u=o(u,d,m,p,t[a+5],21,-57434055),p=o(p,u,d,m,t[a+12],6,1700485571),m=o(m,p,u,d,t[a+3],10,-1894986606),d=o(d,m,p,u,t[a+10],15,-1051523),u=o(u,d,m,p,t[a+1],21,-2054922799),p=o(p,u,d,m,t[a+8],6,1873313359),m=o(m,p,u,d,t[a+15],10,-30611744),d=o(d,m,p,u,t[a+6],15,-1560198380),u=o(u,d,m,p,t[a+13],21,1309151649),p=o(p,u,d,m,t[a+4],6,-145523070),m=o(m,p,u,d,t[a+11],10,-1120210379),d=o(d,m,p,u,t[a+2],15,718787259),u=o(u,d,m,p,t[a+9],21,-343485551),p=e(p,h),u=e(u,_),d=e(d,c),m=e(m,l);return[p,u,d,m]}function _(t){var e,i="";for(e=0;32*t.length>e;e+=8)i+=String.fromCharCode(255&t[e>>5]>>>e%32);return i}function c(t){var e,i=[];for(i[(t.length>>2)-1]=void 0,e=0;i.length>e;e+=1)i[e]=0;for(e=0;8*t.length>e;e+=8)i[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return i}function l(t){return _(h(c(t),8*t.length))}function p(t,e){var i,a,n=c(t),s=[],r=[];for(s[15]=r[15]=void 0,n.length>16&&(n=h(n,8*t.length)),i=0;16>i;i+=1)s[i]=909522486^n[i],r[i]=1549556828^n[i];return a=h(s.concat(c(e)),512+8*e.length),_(h(r.concat(a),640))}function u(t){var e,i,a="0123456789abcdef",n="";for(i=0;t.length>i;i+=1)e=t.charCodeAt(i),n+=a.charAt(15&e>>>4)+a.charAt(15&e);return n}function d(t){return unescape(encodeURIComponent(t))}function m(t){return l(d(t))}function f(t){return u(m(t))}function v(t,e){return p(d(t),d(e))}function E(t,e){return u(v(t,e))}function T(t,e,i){return e?i?v(e,t):E(e,t):i?m(t):f(t)}"function"==typeof define&&define.amd?define(function(){return T}):t.md5=T}(e),function(t){"use strict";function e(){}var i="js",a="1",n="3",s="1",r="1",o="845cc96",h=1;e.getVersion=function(){return i+"-"+a+"."+n+"."+s+"."+r+"-"+o},e.getMajor=function(){return a},e.getMinor=function(){return n},e.getMicro=function(){return s},e.getPatch=function(){return r},e.getBuild=function(){return o},e.getApiLevel=function(){return h},t.Version=e}(i),function(t){"use strict";function e(t,e){function i(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t}t.extend=e}(a),function(t){"use strict";function e(t,e){var i=[];for(var a in e)e.hasOwnProperty(a)&&"function"==typeof e[a]&&i.push(a);for(var n=0;i.length>n;n++){var s=i[n];t.prototype[s]=e[s]}}t.mixin=e}(a),function(t){"use strict";t.deferrable={executeDeferred:function(){this._deferred&&this._deferred.apply(this,arguments),this._deferred=null}}}(a),function(t){"use strict";t.LOGGING_ENABLED=!1,t.logger={enableLogging:function(t){this._logEnabled=!0,this._logTag=t},disableLogging:function(){this._logEnabled=!1},log:function(e){t.LOGGING_ENABLED&&this._logEnabled&&window.console&&window.console.log&&window.console.log(this._logTag+e)},info:function(e){t.LOGGING_ENABLED&&this._logEnabled&&window.console&&window.console.info&&window.console.info(this._logTag+e)},warn:function(e){t.LOGGING_ENABLED&&this._logEnabled&&window.console&&window.console.warn&&window.console.warn(this._logTag+e)},error:function(e){if(t.LOGGING_ENABLED&&this._logEnabled&&window.console&&window.console.error)throw e=this._logTag+e,window.console.error(e),Error(e)}}}(a),function(t){"use strict";function e(t,e){this.type=t,this.data=e}e.SUCCESS="success",e.ERROR="error",t.Event=e}(a),function(t){"use strict";function e(){this._events={}}e.prototype.addEventListener=function(t,e,i){t&&e&&(i=i||window,this._events[t]=this._events[t]||[],this._events[t].push({cb:e,ctx:i}))},e.prototype.removeEventListener=function(t,e,i){if(t&&e){i=i||window;var a,n,s=!1;for(n in this._events)if(t===n){s=!0;break}if(s){for(a=this._events[n].length-1;a>=0;a--){var r=this._events[n][a];e===r.cb&&i===r.ctx&&this._events[n].splice(a,1)}this._events[n].length||delete this._events[n]}}},e.prototype.dispatchEvent=function(t){if(t.type){var e,i;for(e in this._events)if(this._events.hasOwnProperty(e)&&t.type===e){var a=this._events[e];for(i=0;a.length>i;i++)a[i].cb.call(a[i].ctx,t);break}}},e.prototype.removeAllListeners=function(t){if(t){var e,i;for(i in this._events)if(this._events.hasOwnProperty(i)){for(e=this._events[i].length-1;e>=0;e--){var a=this._events[i][e];a.ctx===t&&this._events[i].splice(e,1)}this._events[i].length||delete this._events[i]}}else this._events={}},t.EventDispatcher=e}(a),function(t){function e(t){this._workQueue=[],this._delay=t!==void 0?t:0,this._drainInProgress=!1}e.prototype.clear=function(){this._workQueue=[]},e.prototype.isEmpty=function(){return 0===this._workQueue.length},e.prototype.drain=function(){if(!this._drainInProgress){this._drainInProgress=!0;var t=this;(function e(){var i=t._workQueue.shift();i?t._runJob(i,function(){e()}):t._drainInProgress=!1})()}},e.prototype.flush=function(){for(var t=0;this._workQueue.length>t;t++){var e=this._workQueue[t];e.fn.apply(e.ctx,e.args)}this._workQueue=[]},e.prototype.addJob=function(t,e,i,a){i=i!==void 0?i:null,a=a!==void 0?a:null,this._workQueue.push({name:t,fn:e,args:i,ctx:a})},e.prototype._runJob=function(t,e){var i=this;setTimeout(function(){t.fn.apply(t.ctx,t.args),null!=e&&e.call(i)},this._delay)},t.WorkQueue=e}(a),function(t){"use strict";function e(){}function i(t,e){this.url=t||null,this.method=e,this._xmlhttp=null}function a(){a.__super__.constructor.call(this),this._connection=null}var n=t.Event,s=t.EventDispatcher;e.GET="GET",a.RESPONSE="response",a.INSTANCE="instance",t.extend(a,s),a.prototype._createCORSRequest=function(e){var i=null;if(window.XMLHttpRequest!==void 0){var s=new window.XMLHttpRequest;"withCredentials"in s&&(i=s,i.open(e.method,e.url,!0))}if(null==i&&window.XDomainRequest!==void 0&&(i=new window.XDomainRequest,i.open(e.method,e.url)),i){var r={};r[a.INSTANCE]=this;var o=this;i.onload=function(){return i.status&&parseInt(i.status,10)>=400?this.onerror():(r[a.RESPONSE]=i.responseText,o.dispatchEvent(new n(n.SUCCESS,r)),void 0)},i.onerror=function(){o.dispatchEvent(new t.Event(n.ERROR,r))}}return i},a.prototype._loadImage=function(e){this._connection||(this._connection=new Image,this._connection.alt=""),this._connection.src=e.url;var i={};i[a.RESPONSE]="",i[a.INSTANCE]=this,this.dispatchEvent(new t.Event(n.SUCCESS,i))},a.prototype.close=function(){this.removeAllListeners()},a.prototype.load=function(t){t&&t.method&&t.url&&(t._xmlhttp=this._createCORSRequest(t),t._xmlhttp?t._xmlhttp.send():this._loadImage(t))},t.URLRequestMethod=e,t.URLRequest=i,t.URLLoader=a}(a),function(t){"use strict";function e(t,e,i){this.fn=t,this.ctx=e,this.params=i}e.prototype.run=function(){this.fn.apply(this.ctx,this.params)},t.Operation=e}(a),function(t){"use strict";function e(){this._queue=[]}e.prototype.addOperation=function(t){this._queue.push(t),this._processQueue()},e.prototype.cancelAllOperations=function(){this._queue=[]},e.prototype._processQueue=function(){if(this._queue.length){var t=this._queue.shift(),e=this;setTimeout(function(){t.run(),e._processQueue()},0)}},t.OperationQueue=e}(a),function(t){"use strict";function e(){this.notificationCenter=new i,this.workQueue=new a}var i=t.EventDispatcher,a=t.OperationQueue;t.CommCenter=e}(a),function(t){"use strict";function e(){this.playerName=null,this.name=null,this.position=null,this.startTime=null}t.AdBreakInfo=e}(i),function(t){"use strict";function e(){this.id=null,this.name=null,this.length=null,this.playhead=null,this.position=null,this.cpm=null}t.AdInfo=e}(i),function(t){"use strict";t.ASSET_TYPE_VOD="vod",t.ASSET_TYPE_LIVE="live",t.ASSET_TYPE_LINEAR="linear"}(i),function(t){"use strict";function e(){this.name=null,this.length=null,this.position=null,this.startTime=null}t.ChapterInfo=e}(i),function(t){"use strict";function e(t,e,n){this.trackingServer=t,this.jobId=e,this.publisher=n,this.channel=a,this.ovp=i,this.sdk=i,this.debugLogging=!1,this.quietMode=!1,this.__primetime=!1,this.__psdkVersion=null}var i="unknown",a="";t.ConfigData=e}(i),function(t){"use strict";function e(t,e){this.message=t,this.details=e}t.ErrorInfo=e}(i),function(t){"use strict";function e(){}e.prototype.configure=function(){},e.prototype.destroy=function(){},e.prototype.trackVideoLoad=function(){},e.prototype.trackVideoUnload=function(){},e.prototype.trackPlay=function(){},e.prototype.trackPause=function(){},e.prototype.trackBufferStart=function(){},e.prototype.trackBufferComplete=function(){},e.prototype.trackSeekStart=function(){},e.prototype.trackSeekComplete=function(){},e.prototype.trackComplete=function(){},e.prototype.trackChapterStart=function(){},e.prototype.trackChapterComplete=function(){},e.prototype.trackAdBreakStart=function(){},e.prototype.trackAdBreakComplete=function(){},e.prototype.trackAdStart=function(){},e.prototype.trackAdComplete=function(){},e.prototype.trackBitrateChange=function(){},e.prototype.trackVideoPlayerError=function(){},e.prototype.trackApplicationError=function(){},t.HeartbeatProtocol=e}(i),function(t){"use strict";function e(){}e.prototype.getVideoInfo=function(){throw Error("Implementation error: Method must be overridden.")},e.prototype.getAdBreakInfo=function(){return null},e.prototype.getAdInfo=function(){return null},e.prototype.getChapterInfo=function(){return null},e.prototype.getQoSInfo=function(){return null},e.prototype.onError=function(){},e.prototype.onVideoUnloaded=function(){},t.PlayerDelegate=e}(i),function(t){"use strict";function e(){this.bitrate=null,this.fps=null,this.droppedFrames=null}t.QoSInfo=e}(i),function(t){"use strict";function e(){this.playerName=null,this.id=null,this.name=null,this.length=null,this.playhead=null,this.streamType=null}t.VideoInfo=e}(i),function(t,e){"use strict";function i(t){this._invalidDataOperation=t}function a(t){if(t){if(null==t.id||""===t.id)return"Video ID cannot be null or empty string";if(t.streamType!=e.ASSET_TYPE_VOD&&t.streamType!=e.ASSET_TYPE_LIVE&&t.streamType!=e.ASSET_TYPE_LINEAR)return"Video ID must be one of "+e.ASSET_TYPE_VOD+", "+e.ASSET_TYPE_LIVE+", "+e.ASSET_TYPE_LINEAR;if(null==t.length||isNaN(t.length))return"Video length cannot be null or NaN";if(null==t.playhead||isNaN(t.playhead))return"Video playhead cannot be null or NaN";if(null==t.playerName||""===t.playerName)return"Video player-name cannot be null or empty string."}return null}function n(t){if(t){if(null==t.playerName||""===t.playerName)return"Ad-break player-name cannot be null or empty string";if(null==t.position||isNaN(t.position))return"Ad-break position cannot be null or NaN"}return null}function s(t){if(t){if(null==t.id||""===t.id)return"Ad ID cannot be null or empty string";if(null==t.playhead||isNaN(t.playhead))return"Ad playhead cannot be null or NaN";if(null==t.position||isNaN(t.position))return"Ad position cannot be null or NaN";if(null==t.length||isNaN(t.length))return"Ad length cannot be null or NaN"}return null}function r(t){if(t){if(null==t.position||isNaN(t.position))return"Chapter position cannot be null or NaN";if(null==t.startTime||isNaN(t.startTime))return"Chapter offset (start-time) cannot be null or NaN";if(null==t.length||isNaN(t.length))return"Chapter length cannot be null or NaN"}return null}i.prototype.sanitizeVideoInfo=function(t){if(!t)return this._fail("VideoInfo cannot be null");var e=a(t);return e?this._fail(e):!0},i.prototype.sanitizeAdBreakInfo=function(t,e){if(!e&&!t)return this._fail("AdBreakInfo cannot be null");var i=n(t);return i?this._fail(i):!0},i.prototype.sanitizeAdInfo=function(t,e){if(!e&&!t)return this._fail("AdInfo cannot be null");var i=s(t);return i?this._fail(i):!0},i.prototype.sanitizeChapterInfo=function(t,e){if(!e&&!t)return this._fail("ChapterInfo cannot be null");var i=r(t);return i?this._fail(i):!0},i.prototype._fail=function(t){return this._invalidDataOperation.params=["Invalid input data",t],this._invalidDataOperation.run(),!1},t.InputDataSanitizer=i}(a,i),function(t,e){"use strict";function i(){}i.REPORT="report",i.WHAT="what",i.RESET="reset",i.ACCOUNT="account",i.SC_TRACKING_SERVER="sc_tracking_server",i.TRACKING_SERVER="tracking_server",i.CHECK_STATUS_SERVER="check_status_server",i.JOB_ID="job_id",i.PUBLISHER="publisher",i.OVP="ovp",i.SDK="sdk",i.CHANNEL="channel",i.USE_SSL="use_ssl",i.QUIET_MODE="quiet_mode",i.ANALYTICS_VISITOR_ID="analytics_visitor_id",i.MARKETING_CLOUD_VISITOR_ID="marketing_cloud_visitor_id",i.VISITOR_ID="visitor_id",i.VIDEO_INFO="video_info",i.AD_INFO="ad_info",i.AD_BREAK_INFO="ad_break_info",i.CHAPTER_INFO="chapter_info",i.MESSAGE="message",i.DETAILS="details",i.TIMER_INTERVAL="timer_interval",i.TRACKING_INTERVAL="tracking_interval",i.CHECK_STATUS_INTERVAL="check_status_interval",i.TRACK_EXTERNAL_ERRORS="track_external_errors",i.SOURCE="source",i.ERROR_ID="error_id",e.event.EventKeyName=i}(a,n),function(t,e){"use strict";function i(t,e){i.__super__.constructor.call(this,t,e)}var a=t.Event;t.extend(i,a),i.API_CONFIG="api_config",i.API_VIDEO_LOAD="api_video_load",i.API_VIDEO_UNLOAD="api_video_unload",i.API_VIDEO_START="api_video_start",i.API_VIDEO_COMPLETE="api_video_complete",i.API_AD_START="api_ad_start",i.API_AD_COMPLETE="api_ad_complete",i.API_PLAY="api_play",i.API_PAUSE="api_pause",i.API_BUFFER_START="api_buffer_start",i.API_SEEK_START="api_seek_start",i.API_SEEK_COMPLETE="api_seek_complete",i.API_CHAPTER_START="api_chapter_start",i.API_CHAPTER_COMPLETE="api_chapter_complete",i.API_TRACK_ERROR="api_track_error",i.API_BITRATE_CHANGE="api_bitrate_change",e.event.ApiEvent=i}(a,n),function(t,e){"use strict";function i(t,e){i.__super__.constructor.call(this,t,e)}var a=t.Event;t.extend(i,a),i.CONTEXT_DATA_AVAILABLE="context_data_available",e.event.ContextEvent=i}(a,n),function(t,e){"use strict";function i(t,e){i.__super__.constructor.call(this,t,e)}var a=t.Event;t.extend(i,a),i.DATA_REQUEST="data_request",i.DATA_RESPONSE="data_response",i.keys={TRACKING_TIMER_INTERVAL:"tracking_timer_interval",MAIN_VIDEO_PUBLISHER:"main_video_publisher"},e.event.DataEvent=i}(a,n),function(t,e){"use strict";function i(t,e){i.__super__.constructor.call(this,t,e)}var a=t.Event;t.extend(i,a),i.NETWORK_CHECK_STATUS_COMPLETE="network_check_status_complete",e.event.NetworkEvent=i}(a,n),function(t,e){"use strict";function i(t,e){i.__super__.constructor.call(this,t,e)}var a=t.Event;t.extend(i,a),i.CLOCK_TRACKING_TICK="CLOCK_TRACKING_TICK",i.CLOCK_TRACKING_ENABLE="CLOCK_TRACKING_ENABLE",i.CLOCK_TRACKING_DISABLE="CLOCK_TRACKING_DISABLE",i.CLOCK_CHECK_STATUS_TICK="CLOCK_CHECK_STATUS_TICK",i.CLOCK_CHECK_STATUS_ENABLE="CLOCK_CHECK_STATUS_ENABLE",i.CLOCK_CHECK_STATUS_DISABLE="CLOCK_CHECK_STATUS_DISABLE",e.event.ClockEvent=i}(a,n),function(t,e){"use strict";function i(t,e){i.__super__.constructor.call(this,t,e)}var a=t.Event;t.extend(i,a),i.ERROR="error",e.event.ErrorEvent=i}(a,n),function(t,e){"use strict";function i(t,e){this.value=t,this.hint=e}function a(t){this.realm=t,this.data={}}i.HINT_SHORT="short",a.prototype._createAccessor=function(t,e,i){var a=this;return function(){return arguments.length&&(a[t]=arguments[0],a.setField(e,arguments[0],i)),a[t]}},a.prototype.setField=function(t,e,a){this.data[t]=new i(e,a)},e.model.Dao=a,e.model.DaoField=i}(a,n),function(t,e){"use strict";function i(t,e){i.__super__.constructor.call(this,t),this.year=this._createAccessor("_year","year",n.HINT_SHORT),this.month=this._createAccessor("_month","month",n.HINT_SHORT),this.day=this._createAccessor("_day","day",n.HINT_SHORT),this.hour=this._createAccessor("_hour","hour",n.HINT_SHORT),this.minute=this._createAccessor("_minute","minute",n.HINT_SHORT),this.second=this._createAccessor("_second","second",n.HINT_SHORT),this.year(e.getUTCFullYear()),this.month(e.getUTCMonth()+1),this.day(e.getUTCDate()),this.hour(e.getUTCHours()),this.minute(e.getUTCMinutes()),this.second(e.getUTCSeconds())}var a=e.model.Dao,n=e.model.DaoField;t.extend(i,a),e.model.DateDao=i}(a,n),function(t,e){"use strict";function i(){if(i.__super__.constructor.call(this,"asset"),this.cpm=this._createAccessor("_cpm","cpm",null),this.adId=this._createAccessor("_adId","ad_id",null),this.sid=this._createAccessor("_sid","ad_sid",null),this.resolver=this._createAccessor("_resolver","resolver",null),this.podId=this._createAccessor("_podId","pod_id",null),this.podPosition=this._createAccessor("_podPosition","pod_position",null),this.podSecond=this._createAccessor("_podSecond","pod_second",null),this.length=this._createAccessor("_length","length",null),this.cpm(""),this.adId(""),this.sid(""),this.resolver(""),this.podId(""),this.podPosition(""),this.podSecond(0),this.length(0),arguments.length&&arguments[0]instanceof i){var t=arguments[0];this.cpm(t.cpm()),this.adId(t.adId()),this.sid(t.sid()),this.resolver(t.resolver()),this.podId(t.podId()),this.podPosition(t.podPosition()),this.podSecond(t.podSecond()),this.length(t.length())}}var a=e.model.Dao;t.extend(i,a),e.model.AdDao=i}(a,n),function(t,e){"use strict";function i(){if(i.__super__.constructor.call(this,"stream"),this.id=this._createAccessor("_id","chapter_id",null),this.sid=this._createAccessor("_sid","chapter_sid",null),this.name=this._createAccessor("_name","chapter_name",null),this.position=this._createAccessor("_position","chapter_pos",null),this.length=this._createAccessor("_length","chapter_length",null),this.offset=this._createAccessor("_offset","chapter_offset",null),this.id(""),this.sid(""),this.name(""),this.position(0),this.length(0),this.offset(0),arguments.length&&arguments[0]instanceof i){var t=arguments[0];this.id(t.id()),this.sid(t.sid()),this.name(t.name()),this.position(t.position()),this.length(t.length()),this.offset(t.offset())}}var a=e.model.Dao;t.extend(i,a),e.model.ChapterDao=i}(a,n),function(t,e){"use strict";function i(){if(i.__super__.constructor.call(this,"asset"),this.type=this._createAccessor("_type","type",null),this.videoId=this._createAccessor("_videoId","video_id",null),this.publisher=this._createAccessor("_publisher","publisher",null),this.adData=this._createAccessor("_adData","ad_data",null),this.chapterData=this._createAccessor("_chapterData","chapter_data",null),this.duration=this._createAccessor("_duration","duration",null),this.type(""),this.videoId(""),this.publisher(""),this.adData(null),this.chapterData(null),this.duration(0),arguments.length&&arguments[0]instanceof i){var t=arguments[0];this.type(t.type()),this.videoId(t.videoId()),this.publisher(t.publisher()),this.duration(t.duration());var e=t.adData();e&&this.adData(new n(e));var a=t.chapterData();a&&this.chapterData(new s(a))}}var a=e.model.Dao,n=e.model.AdDao,s=e.model.ChapterDao;t.extend(i,a),i.TYPE_VOD="vod",i.TYPE_LIVE="live",i.TYPE_LINEAR="linear",i.TYPE_AD="ad",e.model.AssetDao=i}(a,n),function(t,e){"use strict";function i(t){i.__super__.constructor.call(this,"event"),this._trackingInterval=t,this.type=this._createAccessor("_type","type",null),this.count=this._createAccessor("_count","count",null),this.totalCount=this._createAccessor("_totalCount","total_count",null),this.duration=this._createAccessor("_duration","duration",null),this.totalDuration=this._createAccessor("_totalDuration","total_duration",null),this.playhead=this._createAccessor("_playhead","playhead",null),this.id=this._createAccessor("_id","id",null),this.source=this._createAccessor("_source","source",null),this.prevTs=this._createAccessor("_prevTs","prev_ts",null),this.type(""),this.count(0),this.totalCount(0),this.duration(0),this.totalDuration(0),this.playhead(0),this.id(""),this.source(""),this.ts((new Date).getTime()),this._updateTsAsDate(),this.prevTs(-1)}var a=e.model.Dao,n=e.model.DateDao;t.extend(i,a),i.prototype._updateTsAsDate=function(){var t=1e3*this._trackingInterval,e=Math.floor(this._ts/t)*t;this.tsAsDate(new Date(e))},i.prototype.ts=function(){return arguments.length&&(this._ts=arguments[0],this.setField("ts",this._ts,null),this._updateTsAsDate()),this._ts},i.prototype.tsAsDate=function(){if(arguments.length){this._tsAsDate=arguments[0];var t=new n(this.realm,this._tsAsDate);this.setField("ts_as_date",t,null)}return this._tsAsDate},i.EVENT_TYPE_LOAD="load",i.EVENT_TYPE_UNLOAD="unload",i.EVENT_TYPE_START="start",i.EVENT_TYPE_CHAPTER_START="chapter_start",i.EVENT_TYPE_CHAPTER_COMPLETE="chapter_complete",i.EVENT_TYPE_PLAY="play",i.EVENT_TYPE_PAUSE="pause",i.EVENT_TYPE_BUFFER="buffer",i.EVENT_TYPE_BITRATE_CHANGE="bitrate_change",i.EVENT_TYPE_ERROR="error",i.EVENT_TYPE_ACTIVE="active",i.EVENT_TYPE_COMPLETE="complete",e.model.EventDao=i}(a,n),function(t,e){"use strict";function i(){i.__super__.constructor.call(this,"stream"),this.bitrate=this._createAccessor("_bitrate","bitrate",null),this.fps=this._createAccessor("_fps","fps",null),this.droppedFrames=this._createAccessor("_droppedFrames","dropped_frames",null),this.bitrate(0),this.fps(0),this.droppedFrames(0)}var a=e.model.Dao;t.extend(i,a),e.model.QoSDao=i}(a,n),function(t,e){"use strict";function i(){i.__super__.constructor.call(this,"sc"),this.reportSuiteId=this._createAccessor("_reportSuiteId","rsid",null),this.trackingServer=this._createAccessor("_trackingServer","tracking_server",null),this.ssl=this._createAccessor("_ssl","ssl",n.HINT_SHORT),this.reportSuiteId(""),this.trackingServer(""),this.ssl(0)}var a=e.model.Dao,n=e.model.DaoField;t.extend(i,a),e.model.SiteCatalystDao=i}(a,n),function(t,e){"use strict";function i(){i.__super__.constructor.call(this,"sp"),this.ovp=this._createAccessor("_ovp","ovp",null),this.sdk=this._createAccessor("_sdk","sdk",null),this.channel=this._createAccessor("_channel","channel",null),this.playerName=this._createAccessor("_playerName","player_name",null),this.libVersion=this._createAccessor("_libVersion","hb_version",null),this.apiLevel=this._createAccessor("_apiLevel","hb_api_lvl",null),this.ovp(n),this.sdk(n),this.channel(n),this.playerName(""),this.libVersion(""),this.apiLevel(0)}var a=e.model.Dao,n="unknown";t.extend(i,a),e.model.ServiceProviderDao=i}(a,n),function(t,e){"use strict";function i(){i.__super__.constructor.call(this,"event"),this.sessionId=this._createAccessor("_sessionId","sid",null),this.sessionId(null)}var a=e.model.Dao;t.extend(i,a),e.model.SessionDao=i}(a,n),function(t,e){"use strict";function i(){if(i.__super__.constructor.call(this,"stream"),this.cdn=this._createAccessor("_cdn","cdn",null),this.name=this._createAccessor("_name","name",null),this.cdn(null),this.name(null),arguments.length&&arguments[0]instanceof i){var t=arguments[0];this.cdn(t.cdn()),this.name(t.name())}}var a=e.model.Dao;t.extend(i,a),e.model.StreamDao=i}(a,n),function(t,e){"use strict";function i(){if(i.__super__.constructor.call(this,"user"),this.device=this._createAccessor("_device","device",null),this.country=this._createAccessor("_country","country",null),this.city=this._createAccessor("_city","city",null),this.latitude=this._createAccessor("_latitude","latitude",null),this.longitude=this._createAccessor("_longitude","longitude",null),this.analyticsVisitorId=this._createAccessor("_analyticsVisitorId","aid",null),this.marketingCloudVisitorId=this._createAccessor("_marketingCloudVisitorId","mid",null),this.visitorId=this._createAccessor("_visitorId","id",null),this.device(null),this.country(null),this.city(null),this.latitude(null),this.longitude(null),this.analyticsVisitorId(null),this.marketingCloudVisitorId(null),this.visitorId(null),arguments.length&&arguments[0]instanceof i){var t=arguments[0];this.device(t.device()),this.country(t.country()),this.city(t.city()),this.latitude(t.latitude()),this.longitude(t.longitude()),this.analyticsVisitorId(t.analyticsVisitorId()),this.marketingCloudVisitorId(t.marketingCloudVisitorId()),this.visitorId(t.visitorId())}}var a=e.model.Dao;t.extend(i,a),e.model.UserDao=i}(a,n),function(t,e){"use strict";function i(t,e,i,a,n){this.eventData=t,this.assetData=e,this.userData=i,this.streamData=a,this.qosData=n}e.model.ReportEntry=i}(a,n),function(t,e){"use strict";function i(t,e,i){this.siteCatalystData=t,this.serviceProviderData=e,this.sessionData=i,this.reportEntries=[]}var a=e.model.EventDao;i.prototype.addEntry=function(t){this.reportEntries.push(t)},i.prototype.discardPauseEvents=function(){if(this.reportEntries.length)for(var t=this.reportEntries.length-1;t>=0;t--)this.reportEntries[t].eventData.type()===a.EVENT_TYPE_PAUSE&&this.reportEntries.splice(t,1)},e.model.Report=i}(a,n),function(t,e){"use strict";function i(){}i.prototype.serializeReport=function(){},i.prototype.serializeReportEntry=function(){},i.prototype.serializeDao=function(){},i.prototype.serializeNumber=function(){},i.prototype.serializeString=function(){},e.model.SerializerProtocol=i}(a,n),function(t,e){"use strict";function i(){this.enableLogging("[heartbeat::QuerystringSerializer] > ")}var a=t.mixin,n=t.logger,s=e.model.Dao,r=e.model.DaoField,o=e.model.SerializerProtocol,h="l",_="h",c="s";t.extend(i,o),a(i,n),i.prototype._appendSerializedData=function(t){return t?t+"&":""},i.prototype._removeLastCharacter=function(t){return t&&t.length>0&&(t=t.substring(0,t.length-1)),t},i.prototype._processDao=function(t){var e=[];for(var i in t.data)if(t.data.hasOwnProperty(i)){var a=t.data[i],n=a.value,r=a.hint,o=null,h=t.realm;if(null===n||n===void 0)continue;"number"==typeof n?o=this.serializeNumber(i,n,h,r):"string"==typeof n?o=this.serializeString(i,n,h,r):n instanceof s?o=this.serializeDao(n):this.warn("#_processDao() > Unable to serialize DAO. Field: "+i+". Value: "+n+"."),o&&e.push(o)}return e},i.prototype.serializeReport=function(t){for(var e=[],i=t.reportEntries,a=0;i.length>a;a++){var n=this.serializeReportEntry(i[a])+"&";n+=this._appendSerializedData(this.serializeDao(t.siteCatalystData)),n+=this._appendSerializedData(this.serializeDao(t.serviceProviderData)),n+=this._appendSerializedData(this.serializeDao(t.sessionData)),n=this._removeLastCharacter(n),e.push(n)}return e},i.prototype.serializeReportEntry=function(t){var e=this._appendSerializedData(this.serializeDao(t.eventData));return e+=this._appendSerializedData(this.serializeDao(t.assetData)),e+=this._appendSerializedData(this.serializeDao(t.userData)),e+=this._appendSerializedData(this.serializeDao(t.streamData)),e+=this._appendSerializedData(this.serializeDao(t.qosData)),e=this._removeLastCharacter(e)},i.prototype.serializeDao=function(t){for(var e=this._processDao(t),i="",a=0;e.length>a;a++)i+=a==e.length-1?e[a]:e[a]+"&";return i},i.prototype.serializeNumber=function(t,e,i,a){var n=h;return null==e||void 0===e||isNaN(e)?null:(a&&"string"==typeof a&&a===r.HINT_SHORT&&(n=_),n+":"+i+":"+t+"="+Math.floor(e))},i.prototype.serializeString=function(t,e,i){return e?c+":"+i+":"+t+"="+window.encodeURIComponent(e):null},e.model.QuerystringSerializer=i}(a,n),function(t,e){"use strict";function i(t){this.tick=0,this.interval=t,this.isActive=!1}function a(t){this._isDestroyed=!1,this._currentTick=0,this._timers={},this._commCenter=t;var e=this;this._clock=setInterval(function(){e._onTick()},1e3*_),this.enableLogging("[heartbeat::TimerManager] > ")}var n=t.logger,s=t.mixin,r=t.Operation,o=e.event.ClockEvent,h=e.event.EventKeyName,_=1;s(a,n),a.prototype.isTimerActive=function(t){var e=this._timers[t];return e&&e.isActive},a.prototype.createTimer=function(t,e){this._timers[t]=new i(e)},a.prototype.destroyTimer=function(t){delete this._timers[t]},a.prototype.startTimer=function(t,e){this.log("#startTimer(name="+t+", reset="+e+")");var i=this._timers[t];i&&(i.isActive=!0,e&&(i.tick=0))},a.prototype.stopTimer=function(t,e){this.log("#stopTimer(name="+t+", reset="+e+")");var i=this._timers[t];i&&(i.isActive=!1,e&&(i.tick=0))},a.prototype.destroy=function(){this._isDestroyed||(this._isDestroyed=!0,clearInterval(this._clock))},a.prototype._onTick=function(){var t=new r(function(){this.log("#_onTick() > ------------------- ("+this._currentTick+")"),this._currentTick++;for(var t in this._timers)if(this._timers.hasOwnProperty(t)){var e=this._timers[t];if(e.isActive&&(e.tick++,0===e.tick%e.interval)){var i={};i[h.TIMER_INTERVAL]=e.interval,this._commCenter.notificationCenter.dispatchEvent(new o(o[t],i))}}},this);this._commCenter.workQueue.addOperation(t)},e.clock.TimerManager=a}(a,n),function(t,e){"use strict";function i(t,e,i,a,n,s){this.enableLogging("[media-fork::Timer] > "),this._isDestroyed=!1,this._commCenter=t,this._timerManager=e,this._interval=s,this._tickEventName=i,this._enableEventName=a,this._disableEventName=n,this._timerManager.createTimer(this._tickEventName,this._interval),this._commCenter.notificationCenter.addEventListener(this._enableEventName,this._onTimerEnabled,this),this._commCenter.notificationCenter.addEventListener(this._disableEventName,this._onTimerDisabled,this)}var a=t.logger,n=t.mixin,s=e.event.EventKeyName;n(i,a),i.prototype.start=function(t){this.log("Starting timer: "+this._tickEventName),this._timerManager.startTimer(this._tickEventName,t)},i.prototype.stop=function(t){this.log("Stopping timer: "+this._tickEventName+")"),this._timerManager.stopTimer(this._tickEventName,t)},i.prototype.destroy=function(){this._isDestroyed||(this._isDestroyed=!0,this._commCenter.notificationCenter.removeAllListeners(this),this._timerManager.destroyTimer(this._tickEventName))},i.prototype.setInterval=function(t){var e=this._timerManager.isTimerActive(this._tickEventName);this.stop(!0),this._interval=t,this._timerManager.createTimer(this._tickEventName,this._interval),e&&this.start(!0)},i.prototype._onTimerEnabled=function(t){var e=t.data,i=!1;e&&e.hasOwnProperty(s.RESET)&&(i=e[s.RESET]),this.start(i)},i.prototype._onTimerDisabled=function(t){var e=t.data,i=!1;e&&e.hasOwnProperty(s.RESET)&&(i=e[s.RESET]),this.stop(i)},e.clock.Timer=i}(a,n),function(t,e){"use strict";function i(t,e){i.__super__.constructor.call(this,t,e,o.CLOCK_TRACKING_TICK,o.CLOCK_TRACKING_ENABLE,o.CLOCK_TRACKING_DISABLE,c),this._commCenter.notificationCenter.addEventListener(r.NETWORK_CHECK_STATUS_COMPLETE,this._onCheckStatusComplete,this),this._commCenter.notificationCenter.addEventListener(s.DATA_REQUEST,this._onDataRequest,this),this.enableLogging("[heartbeat::TrackingTimer] > ")
}var a=t.mixin,n=t.logger,s=e.event.DataEvent,r=e.event.NetworkEvent,o=e.event.ClockEvent,h=e.event.EventKeyName,_=e.clock.Timer,c=10;t.extend(i,_),a(i,n),i.prototype.destroy=function(){this._isDestroyed||(this._commCenter.notificationCenter.removeEventListener(r.NETWORK_CHECK_STATUS_COMPLETE,this._onCheckStatusComplete,this),this._commCenter.notificationCenter.removeEventListener(s.DATA_REQUEST,this._onDataRequest,this),i.__super__.destroy.call(this))},i.prototype._onCheckStatusComplete=function(t){var e=t.data[h.TRACKING_INTERVAL];if(this.log("#_onCheckStatusComplete(interval="+e+")"),e){if(e==this._interval)return this.log("#_onCheckStatusComplete() > Interval value not changed."),void 0;this.log("#_onCheckStatusComplete() > Interval changed to: "+e),this.setInterval(e)}else this.warn("#_onCheckStatusComplete() > Invalid interval value."),this.setInterval(c)},i.prototype._onDataRequest=function(t){var e=t.data[h.WHAT];switch(this.log("#_onDataRequest(what="+e+")"),e){case s.keys.TRACKING_TIMER_INTERVAL:var i={};i[h.TIMER_INTERVAL]=this._interval,this._commCenter.notificationCenter.dispatchEvent(new s(s.DATA_RESPONSE,i))}},e.clock.TrackingTimer=i}(a,n),function(t,e){"use strict";function i(t,e){i.__super__.constructor.call(this,t,e,c.CLOCK_CHECK_STATUS_TICK,c.CLOCK_CHECK_STATUS_ENABLE,c.CLOCK_CHECK_STATUS_DISABLE,n),this._commCenter.notificationCenter.addEventListener(h.NETWORK_CHECK_STATUS_COMPLETE,this._onCheckStatusComplete,this),this.enableLogging("[heartbeat::CheckStatusTimer] > "),this.log("#CheckStatusTimer()");var a=this;setTimeout(function(){a._initialCheck()},200)}var a=600,n=60,s=t.mixin,r=t.logger,o=t.Operation,h=e.event.NetworkEvent,_=e.event.EventKeyName,c=e.event.ClockEvent,l=e.clock.Timer;t.extend(i,l),s(i,r),i.prototype.destroy=function(){this._isDestroyed||(this._commCenter.notificationCenter.removeEventListener(h.NETWORK_CHECK_STATUS_COMPLETE,this._onCheckStatusComplete,this),i.__super__.destroy.call(this))},i.prototype._onCheckStatusComplete=function(t){var e=t.data[_.CHECK_STATUS_INTERVAL];if(this.log("#_onCheckStatusComplete(interval="+e+")"),e){if(e==this._interval)return this.log("#_onCheckStatusComplete() > Interval value not changed."),void 0;e>a?(this.warn("#_onCheckStatusComplete() > Interval value too large: "+e),this.setInterval(a)):(this.log("#_onCheckStatusComplete() > Interval changed to: "+e),this.setInterval(e))}else this.warn("#_onCheckStatusComplete() > Invalid interval value."),this.setInterval(n)},i.prototype._initialCheck=function(){var t=new o(function(){this.log("#_initialCheck()");var t={};t[_.TIMER_INTERVAL]=this._interval,this._commCenter.notificationCenter.dispatchEvent(new c(c.CLOCK_CHECK_STATUS_TICK,t))},this);this._commCenter.workQueue.addOperation(t)},e.clock.CheckStatusTimer=i}(a,n),function(t,e){"use strict";function i(t){this._isDestroyed=!1,this._timerManager=new a(t),this._checkStatusTimer=new n(t,this._timerManager),this._trackingTimer=new s(t,this._timerManager)}var a=e.clock.TimerManager,n=e.clock.CheckStatusTimer,s=e.clock.TrackingTimer;i.prototype.destroy=function(){this._isDestroyed||(this._isDestroyed=!0,this._trackingTimer.destroy(),this._checkStatusTimer.destroy(),this._timerManager.destroy())},e.clock.Clock=i}(a,n),function(t,e){"use strict";function i(t){this._data=t,this.enableLogging("[heartbeat::SettingsParser] > "),this.log("#SettingsParser(data="+t+")")}var a=t.mixin,n=t.logger,s=e.event.EventKeyName;e.event.NetworkEvent,a(i,n),i.prototype.parse=function(){var t,e,i,a;if(!this._data)return this.warn("#SettingsParser() > No data available for parsing."),void 0;if(window.DOMParser){var n=new window.DOMParser;a=n.parseFromString(this._data,"text/xml")}else a=new window.ActiveXObject("Microsoft.XMLDOM"),a.async=!1,a.loadXML(this.data);var r;r=parseInt(a.getElementsByTagName("trackingInterval")[0].childNodes[0].nodeValue,10),r&&(t=r),r=parseInt(a.getElementsByTagName("setupCheckInterval")[0].childNodes[0].nodeValue,10),r&&(e=r),r=parseInt(a.getElementsByTagName("trackExternalErrors")[0].childNodes[0].nodeValue,10),r&&(i=1==r);var o={};return o[s.TRACKING_INTERVAL]=t,o[s.CHECK_STATUS_INTERVAL]=e,o[s.TRACK_EXTERNAL_ERRORS]=i,this.log("#parse() > Obtained configuration settings: "+JSON.stringify(o)),o},e.network.SettingsParser=i}(a,n),function(t,e){"use strict";function i(t,e,i){this._jobId=null,this._trackingServer=null,this._checkStatusServer=null,this._quietMode=!1,this._isConfigured=!1,this._isDestroyed=!1,this._commCenter=t,this._serializer=e,this._playerDelegate=i,this._netQueue=new h,this._commCenter.notificationCenter.addEventListener(d.DATA_RESPONSE,this._onDataResponse,this),this._commCenter.notificationCenter.addEventListener(_.API_CONFIG,this._onApiConfig,this),this._commCenter.notificationCenter.addEventListener(f.CONTEXT_DATA_AVAILABLE,this._onContextDataAvailable,this),this._commCenter.notificationCenter.addEventListener(m.CLOCK_CHECK_STATUS_TICK,this._onClockCheckStatusTick,this),this.enableLogging("[heartbeat::Network] > "),this.log("#Network()")}var a=t.mixin,n=t.deferrable,s=t.logger,r=t.Event,o=t.Operation,h=t.OperationQueue,_=e.event.ApiEvent,c=t.URLRequestMethod,l=t.URLRequest,p=t.URLLoader,u=e.event.EventKeyName,d=e.event.DataEvent,m=e.event.ClockEvent,f=e.event.ContextEvent,v=e.event.NetworkEvent,E=e.network.SettingsParser,T=e.model.EventDao;a(i,n),a(i,s),i.prototype.destroy=function(){this._isDestroyed||(this._isDestroyed=!0,this.log("#destroy()"),this._netQueue.cancelAllOperations(),this._commCenter.notificationCenter.removeAllListeners(this))},i.prototype._onApiConfig=function(t){var e=t.data;this.log("#_onApiConfig(sb_server="+e[u.TRACKING_SERVER]+", check_status_server="+e[u.CHECK_STATUS_SERVER]+", job_id="+e[u.JOB_ID]+", use_ssl="+e[u.USE_SSL]+", quiet_mode="+e[u.QUIET_MODE]+")"),this._jobId=e[u.JOB_ID],this._trackingServer=this._updateRequestProtocol(e[u.TRACKING_SERVER],e[u.USE_SSL]),this._checkStatusServer=this._updateRequestProtocol(e[u.CHECK_STATUS_SERVER],e[u.USE_SSL]),this._quietMode=e[u.QUIET_MODE],this._isConfigured=!0},i.prototype._onContextDataAvailable=function(t){if(!this._isConfigured)return this.warn("#_onContextDataAvailable() > Unable to send request: not configured."),void 0;var e=new o(function(){for(var e=t.data[u.REPORT],i=this._serializer.serializeReport(e),a=0;i.length>a;a++){var n=i[a],s=this._trackingServer+"/?__job_id="+this._jobId+"&"+n,o=new l(s,c.GET);this.info("_onContextDataAvailable() > Sending request: "+o.url);var h=new p;(function(t,e){function i(){t.close()}function a(i){e.warn("#_onContextDataAvailable() > Failed to send heartbeat report: "+JSON.stringify(i)),t.close()}e._quietMode||(t.addEventListener(r.SUCCESS,i,this),t.addEventListener(r.ERROR,a,this),t.load(o))})(h,this)}e.reportEntries[0].eventData.type()==T.EVENT_TYPE_UNLOAD&&this._playerDelegate.onVideoUnloaded()},this);this._netQueue.addOperation(e)},i.prototype._onClockCheckStatusTick=function(){if(!this._isConfigured)return this.warn("#_onClockCheckStatusTick() > Unable to send request: not configured."),void 0;var t=this;this._deferred=function(e){var i=e[u.PUBLISHER];if(!i)return this.warn("#_onClockCheckStatusTick() > Publisher is NULL."),void 0;var a=new o(function(){function t(t){if(t.data){var e=new E(t.data.response),i=e.parse();i?a._commCenter.notificationCenter.dispatchEvent(new v(v.NETWORK_CHECK_STATUS_COMPLETE,i)):a.warn("#_onClockCheckStatusTick() > Failed to parse the config. settings.")}o.close()}function e(t){a.warn("#_onClockCheckStatusTick() > Failed to obtain the config. settings: "+JSON.stringify(t)),o.close()}var a=this;i=i.replace(/[^a-zA-Z0-9]+/,"-").toLocaleLowerCase();var n=this._checkStatusServer+i+".xml?r="+(new Date).getTime(),s=new l(n,c.GET),o=new p;o.addEventListener(r.SUCCESS,t,this),o.addEventListener(r.ERROR,e,this),this.log("#_onClockCheckStatusTick() > Get new settings from: "+n),o.load(s)},t);t._netQueue.addOperation(a)};var e={};e[u.WHAT]=d.keys.MAIN_VIDEO_PUBLISHER,this._commCenter.notificationCenter.dispatchEvent(new d(d.DATA_REQUEST,e))},i.prototype._onDataResponse=function(t){this.executeDeferred(t.data)},i.prototype._updateRequestProtocol=function(t,e){var i=t;return 0===i.indexOf("http://")?i=i.slice(7):0===i.indexOf("https://")&&(i=i.slice(8)),e?"https://"+i:"http://"+i},e.network.Network=i}(a,n),function(t,e){"use strict";function i(){this._totalCount={},this._totalDuration={},this.enableLogging("[heartbeat::Counters] > ")}function a(t){var e=t.getAssetId()+"."+t.assetData.type()+"."+t.eventType;return e}var n=t.mixin,s=t.logger;n(i,s),i.prototype.getTotalCount=function(t){var e=a(t);return this._totalCount[e]||(this._totalCount[e]=0),this.log("#getTotalCount(key="+e+")"),this._totalCount[e]},i.prototype.incrementTotalCount=function(t){var e=a(t);this._totalCount[e]||(this._totalCount[e]=0),this.log("#incrementTotalCount(key="+e+")"),this._totalCount[e]++},i.prototype.getTotalDuration=function(t){var e=a(t);return this._totalDuration[e]||(this._totalDuration[e]=0),this.log("#getTotalDuration(key="+e+")"),this._totalDuration[e]},i.prototype.increaseTotalDuration=function(t){var e=a(t);this._totalDuration[e]||(this._totalDuration[e]=0),this.log("#increaseTotalDuration(key="+e+", amount="+t.duration+")"),this._totalDuration[e]+=t.duration},i.prototype.resetCounters=function(t,e){var i=t+"."+e;this.log("#resetCounters(key="+i+")");var a;for(a in this._totalCount)this._totalCount.hasOwnProperty(a)&&-1!=a.indexOf(i)&&(this._totalCount[a]=0);for(a in this._totalDuration)this._totalDuration.hasOwnProperty(a)&&-1!=a.indexOf(i)&&(this._totalDuration[a]=0)},e.context.Counters=i}(a,n),function(t,e){"use strict";function i(){this._items={},this.enableLogging("[heartbeat::History] > ")}function a(t){var e=t.assetData,i=e.adData()?e.adData().adId():e.videoId();return i+"."+e.type()+"."+t.eventType}var n=t.mixin,s=t.logger;n(i,s),i.prototype.updateWith=function(t){var e=a(t);this.log("#updateWith(key="+e+")"),this._items[e]=t},i.prototype.getPreviousItemOfSameTypeWith=function(t){var e=a(t);return this.log("#getPreviousItemOfSameTypeWith(key="+e+")"),this._items[e]},e.context.History=i}(a,n),function(t,e){"use strict";function i(t,e,i,a,o,h){this.timestamp=new Date,this.assetData=new n(t),this.userData=new s(e),this.streamData=new r(i),this.qosData=a,this.eventType=o,this.playhead=h,this.duration=0/0,this.prevItemOfSameType=null}var a=e.model.EventDao,n=e.model.AssetDao,s=e.model.UserDao,r=e.model.StreamDao;i.clone=function(t){var e=new i(t.assetData,t.userData,t.streamData,t.qosData,t.eventType,t.playhead);return e.timestamp=t.timestamp,e},i.prototype.getAssetId=function(){return this.eventType===a.EVENT_TYPE_ACTIVE?this.assetData.videoId():this.assetData.adData()?this.assetData.adData().adId():this.assetData.videoId()},i.prototype.getEventCount=function(){return 1},e.context.TimelineItem=i}(a,n),function(t,e){"use strict";function i(t){this._timeline=[],this._context=t,this.enableLogging("[heartbeat::Timeline] > ")}function a(t,e){return e.getTime()-t.getTime()}var n=t.mixin,s=t.logger,r=e.context.TimelineItem,o=e.model.EventDao;n(i,s),i.prototype.getTimelineItems=function(){return this._timeline.slice()},i.prototype.getLast=function(){return this._timeline.length>0?this._timeline[this._timeline.length-1]:null},i.prototype.addItem=function(t,e){var i=this._context._counters,n=this.getLast();if(n){if(n.eventType==o.EVENT_TYPE_ACTIVE){for(var s=n,h=0,_=this._timeline.length-2;_>=0;_--){var c=this._timeline[_];if(c.eventType==o.EVENT_TYPE_ACTIVE)break;h+=c.duration}s.duration=h}else n.duration=a(n.timestamp,t.timestamp);i.incrementTotalCount(n),i.increaseTotalDuration(n),this.log("#addItem() >  | "+t.assetData.type()+" | "+t.eventType+" | "+t.playhead+" | "+(t.prevItemOfSameType?t.prevItemOfSameType.timestamp.getTime():"-1")+" | "+t.timestamp.getTime())}if(this._timeline.push(t),t.eventType==o.EVENT_TYPE_ACTIVE){var l=r.clone(n);l.prevItemOfSameType=n,l.timestamp=t.timestamp,l.playhead=e,l.duration=0/0,this.addItem(l,e)}},e.context.Timeline=i}(a,n),function(t,e){"use strict";function i(t){this._context=t,this.enableLogging("[heartbeat::ReporterHelper] > ")}var a=t.mixin,n=t.logger,s=e.model.Report,r=e.model.EventDao,o=e.model.AssetDao,h=e.model.ReportEntry;a(i,n),i.prototype.createReportForItem=function(t,e){var i=this._context._counters,a=new s(this._context._siteCatalystData,this._context._serviceProviderData,this._context._sessionData);return t.duration=0,i.incrementTotalCount(t),i.increaseTotalDuration(t),a.addEntry(this._buildReportEntryForItem(t,e)),a},i.prototype.createReportForQuantum=function(t){var e,i,a=this._selectTimelineItemsForCurrentQuantum();for(this.log("#createReportForQuantum() > -------------[ SUMMARY REPORT ]----------------"),e=0;a.length>e;e++)i=a[e],this.log("#createReportForQuantum() >  | "+i.assetData.type()+" | "+i.eventType+" | "+i.playhead+" | "+i.duration);for(a=this._compactTimelineItems(a),this.log("#createReportForQuantum() > -----------------------------------------"),e=0;a.length>e;e++)i=a[e],this.log("#createReportForQuantum() >  | "+i.assetData.type()+" | "+i.eventType+" | "+i.playhead+" | "+i.duration);this.log("#createReportForQuantum() > -----------------------------------------");var n=this._createReport(a,t);return n},i.prototype._selectTimelineItemsForCurrentQuantum=function(){var t,e,i=this._context._timeline.getTimelineItems(),a=[],n=i[i.length-2];if(n.eventType!=r.EVENT_TYPE_ACTIVE)throw Error("Expecting an ACTIVE event as the last item on the timeline.");for(a.unshift(n),e=i.length-3;e>=0&&(t=i[e],t.eventType!=r.EVENT_TYPE_ACTIVE);e--)a.unshift(t);return a},i.prototype._compactTimelineItems=function(t){var e,i=[],a=function(t){var e;for(e=0;i.length>e;e++){var a=i[e],n=!1;if(t.eventType==a.eventType&&t.assetData.type()==a.assetData.type()){if(n=t.assetData.type()==o.TYPE_AD?t.assetData.adData().adId()==a.assetData.adData().adId()&&t.assetData.adData().podPosition()==a.assetData.adData().podPosition():t.assetData.videoId()==a.assetData.videoId(),!n)continue;n=t.assetData.chapterData()?a.assetData.chapterData()&&t.assetData.chapterData().id()==a.assetData.chapterData().id()&&t.assetData.chapterData().position()==a.assetData.chapterData().position():null==a.assetData.chapterData()}if(n)return a}return null};for(e=0;t.length>e;e++){var n=t[e],s=a(n);s?(s.playhead=n.playhead,s.timestamp=n.timestamp,s.duration+=n.duration):i.push(n)}return i},i.prototype._createReport=function(t,e){var i,a=new s(this._context._siteCatalystData,this._context._serviceProviderData,this._context._sessionData);for(i=0;t.length>i;i++)a.addEntry(this._buildReportEntryForItem(t[i],e));var n=a.reportEntries[a.reportEntries.length-1];if(n.eventData.type()!=r.EVENT_TYPE_ACTIVE)throw Error("Expecting the last report entry to represent an ACTIVE event.");for(i=0;a.reportEntries.length-1>i;i++){var o=a.reportEntries[i];o.eventData.tsAsDate(n.eventData.tsAsDate())}return a.discardPauseEvents(),a},i.prototype._buildReportEntryForItem=function(t,e){var i=this._context._counters,a=new r(e);return a.type(t.eventType),a.count(t.getEventCount()),a.duration(t.duration),a.totalCount(i.getTotalCount(t)),a.totalDuration(i.getTotalDuration(t)),a.playhead(t.playhead),a.ts(t.timestamp.getTime()),a.prevTs(t.prevItemOfSameType?t.prevItemOfSameType.timestamp.getTime():-1),new h(a,t.assetData,t.userData,t.streamData,t.qosData)},e.context.ReporterHelper=i}(a,n),function(t,e,i,a){"use strict";function n(t,e){this._userData=null,this._assetData=null,this._streamData=null,this._qosData=null,this._siteCatalystData=new f,this._serviceProviderData=new E,this._sessionData=null,this._videoAssetType=null,this._counters=new y,this._history=null,this._timeline=null,this._configData={publisher:null},this._isTrackingSessionActive=!1,this._isVideoComplete=!1,this._activeAssetId=null,this._isDestroyed=!1,this._reporterHelper=new l(this),this._commCenter=t,this._playerDelegate=e,this._stashedChapterData=null,this._stashedAdData=null,this._trackExternalErrors=!0;var i=new _(this._executeErrorCallback,this);this._inputDataSanitizer=new c(i),this._installEventListeners(),this.enableLogging("[heartbeat::Context] > ")}function s(){return""+(new Date).getTime()+Math.floor(1e9*Math.random())}var r=t.mixin,o=t.deferrable,h=t.logger,_=t.Operation,c=t.InputDataSanitizer,l=e.context.ReporterHelper,p=e.context.Timeline,u=e.context.TimelineItem,d=e.context.History,m=e.model.SessionDao,f=e.model.SiteCatalystDao,v=e.model.AssetDao,E=e.model.ServiceProviderDao,T=e.model.UserDao,C=e.model.StreamDao,A=e.model.QoSDao,g=e.model.ChapterDao,y=e.context.Counters,D=e.event.ClockEvent,I=e.event.NetworkEvent,S=e.event.DataEvent,k=e.event.ApiEvent,R=e.event.ContextEvent,N=e.event.EventKeyName,O=e.model.EventDao,P=e.model.AdDao,L=i.Version,w=a.md5,b="sourceErrorSDK";r(n,o),r(n,h),n.prototype.destroy=function(){this._isDestroyed||(this._isDestroyed=!0,this.log("#destroy()"),this._uninstallEventListeners())},n.prototype._onApiConfig=function(t){var e=t.data;this.log(this,"#_onApiConfig(account="+e[N.ACCOUNT]+", sc_server="+e[N.SC_TRACKING_SERVER]+", sb_server="+e[N.TRACKING_SERVER]+", check_status_server="+e[N.CHECK_STATUS_SERVER]+", job_id="+e[N.JOB_ID]+", publisher="+e[N.PUBLISHER]+", ovp="+e[N.OVP]+", sdk="+e[N.SDK]+", useSSL="+e[N.USE_SSL]+", quietMode: "+e[N.QUIET_MODE]+", channel: "+e[N.CHANNEL]+")"),this._siteCatalystData.reportSuiteId(e[N.ACCOUNT]),this._siteCatalystData.trackingServer(e[N.SC_TRACKING_SERVER]),this._siteCatalystData.ssl(e[N.USE_SSL]?1:0),this._configData.publisher=e[N.PUBLISHER],this._serviceProviderData.ovp(e[N.OVP]),this._serviceProviderData.sdk(e[N.SDK]),this._serviceProviderData.channel(e[N.CHANNEL]),this._serviceProviderData.libVersion(L.getVersion()),this._serviceProviderData.apiLevel(L.getApiLevel()),this._commCenter.notificationCenter.dispatchEvent(new D(D.CLOCK_CHECK_STATUS_ENABLE))},n.prototype._onApiVideoLoad=function(t){var e=t.data,i=e[N.VIDEO_INFO];this.log("#_onApiVideoLoad(id="+i.id+", length="+i.length+", type="+i.streamType+", player_name="+i.playerName+", aid="+e[N.ANALYTICS_VISITOR_ID]+", mid="+e[N.MARKETING_CLOUD_VISITOR_ID]+", vid="+e[N.VISITOR_ID]+")"),this._resetInternalState(),this._activeAssetId=i.id,this._serviceProviderData.playerName(i.playerName),this._userData.analyticsVisitorId(e[N.ANALYTICS_VISITOR_ID]),this._userData.marketingCloudVisitorId(e[N.MARKETING_CLOUD_VISITOR_ID]),this._userData.visitorId(e[N.VISITOR_ID]),this._assetData.videoId(this._activeAssetId),this._assetData.duration(i.length),this._assetData.type(i.streamType),this._videoAssetType=this._assetData.type(),this._streamData.name(i.name||this._activeAssetId),this._sessionData.sessionId(s()),this._counters.resetCounters(this._activeAssetId,this._videoAssetType);var a=this;this._deferred=function(t){var e=t[N.TIMER_INTERVAL];a._updateQoSInfo();var i=new u(a._assetData,a._userData,a._streamData,a._qosData,O.EVENT_TYPE_LOAD,0);i.prevItemOfSameType=a._history.getPreviousItemOfSameTypeWith(i),a._history.updateWith(i);var n=a._reporterHelper.createReportForItem(i,e),s={};s[N.REPORT]=n,this._commCenter.notificationCenter.dispatchEvent(new R(R.CONTEXT_DATA_AVAILABLE,s))};var n={};n[N.WHAT]=S.keys.TRACKING_TIMER_INTERVAL,this._commCenter.notificationCenter.dispatchEvent(new S(S.DATA_REQUEST,n)),this._isTrackingSessionActive=!0},n.prototype._onApiVideoUnload=function(){if(!this._isTrackingSessionActive)return this.warn("#_onApiVideoUnload() > No active tracking session."),void 0;this.log("#_onApiVideoUnload()");var t=this;this._deferred=function(e){var i=e[N.TIMER_INTERVAL],a=new u(t._assetData,t._userData,t._streamData,t._qosData,O.EVENT_TYPE_UNLOAD,0);a.prevItemOfSameType=t._history.getPreviousItemOfSameTypeWith(a),t._history.updateWith(a);var n=t._reporterHelper.createReportForItem(a,i),s={};s[N.REPORT]=n,this._commCenter.notificationCenter.dispatchEvent(new R(R.CONTEXT_DATA_AVAILABLE,s))};var e={};e[N.WHAT]=S.keys.TRACKING_TIMER_INTERVAL,this._commCenter.notificationCenter.dispatchEvent(new S(S.DATA_REQUEST,e)),this._isTrackingSessionActive=!1},n.prototype._onApiVideoStart=function(){if(this._checkCall("_onApiVideoStart")){this.log("#_onApiVideoStart()");var t=this._getPlayhead();if(null!=t&&!isNaN(t)){var e={};e[N.RESET]=!0,this._commCenter.notificationCenter.dispatchEvent(new D(D.CLOCK_TRACKING_ENABLE,e)),this._updateQoSInfo();var i=new u(this._assetData,this._userData,this._streamData,this._qosData,O.EVENT_TYPE_START,t);i.prevItemOfSameType=this._history.getPreviousItemOfSameTypeWith(i),this._placeItemOnTimeline(i,t)}}},n.prototype._onApiVideoComplete=function(){if(this._checkCall("_onApiVideoComplete")){this.log("#_onApiVideoComplete()"),this._updateQoSInfo();var t=new u(this._assetData,this._userData,this._streamData,this._qosData,O.EVENT_TYPE_COMPLETE,this._assetData.duration());t.prevItemOfSameType=this._history.getPreviousItemOfSameTypeWith(t),this._placeItemOnTimeline(t,this._assetData.duration());var e=this;this._deferred=function(t){var i=t[N.TIMER_INTERVAL],a=new v(e._assetData);a.adData(null),a.type(e._videoAssetType);var n=new u(a,e._userData,e._streamData,e._qosData,O.EVENT_TYPE_ACTIVE,a.duration());n.prevItemOfSameType=e._history.getPreviousItemOfSameTypeWith(n),e._placeItemOnTimeline(n,a.duration());var s=e._reporterHelper.createReportForQuantum(i),r={};r[N.REPORT]=s,this._commCenter.notificationCenter.dispatchEvent(new R(R.CONTEXT_DATA_AVAILABLE,r))};var i={};i[N.WHAT]=S.keys.TRACKING_TIMER_INTERVAL,this._commCenter.notificationCenter.dispatchEvent(new S(S.DATA_REQUEST,i)),i={},i[N.RESET]=!0,this._commCenter.notificationCenter.dispatchEvent(new D(D.CLOCK_TRACKING_DISABLE,i)),this._isVideoComplete=!0}},n.prototype._onApiPlay=function(){if(this._checkCall("_onApiPlay")){this.log("#_onApiPlay()");var t=this._getPlayhead();if(null!=t&&!isNaN(t)){this._commCenter.notificationCenter.dispatchEvent(new D(D.CLOCK_TRACKING_ENABLE)),this._updateQoSInfo();var e=new u(this._assetData,this._userData,this._streamData,this._qosData,O.EVENT_TYPE_PLAY,t);e.prevItemOfSameType=this._history.getPreviousItemOfSameTypeWith(e),this._placeItemOnTimeline(e,t)}}},n.prototype._onApiPause=function(){if(this._checkCall("_onApiPause")){this.log("#_onApiPause()");var t=this._getPlayhead();if(null!=t&&!isNaN(t)){this._updateQoSInfo();var e=new u(this._assetData,this._userData,this._streamData,this._qosData,O.EVENT_TYPE_PAUSE,t);e.prevItemOfSameType=this._history.getPreviousItemOfSameTypeWith(e),this._placeItemOnTimeline(e,t),this._commCenter.notificationCenter.dispatchEvent(new D(D.CLOCK_TRACKING_DISABLE))}}},n.prototype._onApiBufferStart=function(){if(this._checkCall("_onApiBufferStart")){this.log("#_onApiBufferStart()");var t=this._getPlayhead();if(null!=t&&!isNaN(t)){this._updateQoSInfo();var e=new u(this._assetData,this._userData,this._streamData,this._qosData,O.EVENT_TYPE_BUFFER,t);e.prevItemOfSameType=this._history.getPreviousItemOfSameTypeWith(e),this._placeItemOnTimeline(e,t)}}},n.prototype._onApiSeekStart=function(){this._checkCall("_onApiSeekStart")&&(this.log("#_onApiSeekStart()"),this._stashedAdData=this._assetData.adData(),this._stashedChapterData=this._assetData.chapterData(),this._assetData.adData(null),this._assetData.type(this._videoAssetType),this._activeAssetId=this._assetData.videoId(),this._assetData.chapterData(null))},n.prototype._onApiSeekComplete=function(){if(this._checkCall("_onApiSeekComplete")){var t=this._playerDelegate.getAdBreakInfo();if(this._inputDataSanitizer.sanitizeAdBreakInfo(t,!0)){var e=this._playerDelegate.getAdInfo();if(this._inputDataSanitizer.sanitizeAdInfo(e,!0)){var i=this._playerDelegate.getChapterInfo();if(this._inputDataSanitizer.sanitizeChapterInfo(i,!0)){if(t&&e){var a=w(this._assetData.videoId())+"_"+t.position;if(this._stashedAdData&&this._stashedAdData.podId()==a&&parseInt(this._stashedAdData.podPosition(),10)==e.position)this._assetData.adData(this._stashedAdData),this._activeAssetId=this._stashedAdData.adId();else if(!this._assetData.adData()){this._activeAssetId=e.id;var n=new P;n.adId(this._activeAssetId),n.length(e.length),n.resolver(t.playerName),n.cpm(e.cpm),n.podId(a),n.podSecond(t.startTime),n.podPosition(e.position+""),n.sid(s()),this._assetData.adData(n)}this._assetData.type(v.TYPE_AD)}else this._assetData.adData(null),this._assetData.type(this._videoAssetType),this._activeAssetId=this._assetData.videoId();if(i){if(this._stashedChapterData&&i.position==this._stashedChapterData.position())this._assetData.chapterData(this._stashedChapterData);else if(!this._assetData.chapterData()){var r=new g;r.id(w(this._assetData.videoId())+"_"+i.position),r.name(i.name),r.length(i.length),r.position(i.position),r.offset(i.startTime),r.sid(s()),this._assetData.chapterData(r)}}else this._assetData.chapterData(null);this._stashedAdData=null,this._stashedChapterData=null}}}}},n.prototype._onApiAdStart=function(t){if(this._checkCall("_onApiAdStart")){var e=t.data[N.AD_BREAK_INFO],i=t.data[N.AD_INFO];this.log("#_onApiAdStart(id="+i.id+", length="+i.length+", player_name="+e.playerName+", parent_name="+this._assetData.videoId()+", pod_pos="+i.position+", pod_offset="+e.startTime+", cpm="+i.cpm+")"),this._activeAssetId=i.id;var a=new P;a.adId(this._activeAssetId),a.length(i.length),a.resolver(e.playerName),a.cpm(i.cpm),a.podId(w(this._assetData.videoId())+"_"+e.position),a.podSecond(e.startTime),a.podPosition(i.position+""),a.sid(s()),this._assetData.adData(a),this._assetData.type(v.TYPE_AD),this._counters.resetCounters(this._activeAssetId,v.TYPE_AD),this._updateQoSInfo();var n=new u(this._assetData,this._userData,this._streamData,this._qosData,O.EVENT_TYPE_START,i.playhead);n.prevItemOfSameType=this._history.getPreviousItemOfSameTypeWith(n),this._placeItemOnTimeline(n,i.playhead)}},n.prototype._onApiAdComplete=function(){if(this._checkCall("_onApiAdComplete")){if(this.log("#_onApiAdComplete()"),this._assetData.type()!=v.TYPE_AD)return this.warn("#_onApiAdComplete() > Ignoring the ad complete event, because we are no longer in an ad."),void 0;this._updateQoSInfo();var t=new u(this._assetData,this._userData,this._streamData,this._qosData,O.EVENT_TYPE_PLAY,this._assetData.adData().length());t.prevItemOfSameType=this._history.getPreviousItemOfSameTypeWith(t),this._placeItemOnTimeline(t,this._assetData.adData().length());var e=new u(this._assetData,this._userData,this._streamData,this._qosData,O.EVENT_TYPE_COMPLETE,this._assetData.adData().length());e.prevItemOfSameType=this._history.getPreviousItemOfSameTypeWith(e),this._placeItemOnTimeline(e,this._assetData.adData().length()),this._assetData.adData(null),this._assetData.type(this._videoAssetType),this._activeAssetId=this._assetData.videoId()}},n.prototype._onApiChapterStart=function(t){if(this._checkCall("_onApiChapterStart")){var e=t.data[N.CHAPTER_INFO];this.log("#_onApiChapterStart(name="+e.name+", length="+e.length+", position="+e.position+", chapter_offset="+e.startTime+")");var i=this._getMainVideoPlayhead();if(null!=i&&!isNaN(i)){var a=this._getPlayhead();if(null!=a&&!isNaN(a)){var n=new g;if(n.id(w(this._assetData.videoId())+"_"+e.position),n.name(e.name),n.length(e.length),n.position(e.position),n.offset(e.startTime),n.sid(s()),this._assetData.chapterData(n),this._updateQoSInfo(),this._timeline.getLast().eventType==O.EVENT_TYPE_PLAY){var r=new u(this._assetData,this._userData,this._streamData,this._qosData,this._timeline.getLast().eventType,a);r.prevItemOfSameType=this._history.getPreviousItemOfSameTypeWith(r),this._placeItemOnTimeline(r,a)}var o=this;this._deferred=function(t){var e=t[N.TIMER_INTERVAL],a=new v(o._assetData);a.adData(null),a.type(o._videoAssetType);var n=new u(a,o._userData,o._streamData,o._qosData,O.EVENT_TYPE_CHAPTER_START,i);n.prevItemOfSameType=o._history.getPreviousItemOfSameTypeWith(n),o._history.updateWith(n);var s=o._reporterHelper.createReportForItem(n,e),r={};r[N.REPORT]=s,o._commCenter.notificationCenter.dispatchEvent(new R(R.CONTEXT_DATA_AVAILABLE,r))};var h={};h[N.WHAT]=S.keys.TRACKING_TIMER_INTERVAL,this._commCenter.notificationCenter.dispatchEvent(new S(S.DATA_REQUEST,h))}}}},n.prototype._onApiChapterComplete=function(){if(this._checkCall("_onApiChapterComplete")){if(this.log("#_onApiChapterComplete()"),!this._assetData.chapterData())return this.warn("#_onApiChapterComplete() > Ignoring the chapter complete event, because we are no longer in a chapter."),void 0;var t=this._getMainVideoPlayhead();if(null!=t&&!isNaN(t)){var e=this._getPlayhead();if(null!=e&&!isNaN(e)){var i=this;this._deferred=function(a){var n=a[N.TIMER_INTERVAL],s=new v(i._assetData);s.adData(null),s.type(i._videoAssetType),i._updateQoSInfo();var r=new u(s,i._userData,i._streamData,i._qosData,O.EVENT_TYPE_CHAPTER_COMPLETE,t);r.prevItemOfSameType=i._history.getPreviousItemOfSameTypeWith(r),i._history.updateWith(r);var o=i._reporterHelper.createReportForItem(r,n),h={};if(h[N.REPORT]=o,i._commCenter.notificationCenter.dispatchEvent(new R(R.CONTEXT_DATA_AVAILABLE,h)),i._assetData.chapterData(null),i._timeline.getLast().eventType==O.EVENT_TYPE_PLAY){var _=new u(i._assetData,i._userData,i._streamData,i._qosData,i._timeline.getLast().eventType,e);_.prevItemOfSameType=i._history.getPreviousItemOfSameTypeWith(_),i._placeItemOnTimeline(_,e)}};var a={};a[N.WHAT]=S.keys.TRACKING_TIMER_INTERVAL,this._commCenter.notificationCenter.dispatchEvent(new S(S.DATA_REQUEST,a))}}}},n.prototype._onApiBitrateChange=function(){if(this._checkCall("_onApiBitrateChange")){this.log("#_onApiBitrateChange()");var t=this._getPlayhead();if(null!=t&&!isNaN(t)){var e=this;this._deferred=function(i){var a=i[N.TIMER_INTERVAL];e._updateQoSInfo();var n=new u(e._assetData,e._userData,e._streamData,e._qosData,O.EVENT_TYPE_BITRATE_CHANGE,t);n.prevItemOfSameType=e._history.getPreviousItemOfSameTypeWith(n),e._history.updateWith(n);var s=e._reporterHelper.createReportForItem(n,a),r={};r[N.REPORT]=s,e._commCenter.notificationCenter.dispatchEvent(new R(R.CONTEXT_DATA_AVAILABLE,r))};var i={};i[N.WHAT]=S.keys.TRACKING_TIMER_INTERVAL,this._commCenter.notificationCenter.dispatchEvent(new S(S.DATA_REQUEST,i))}}},n.prototype._onApiTrackError=function(t){if(this._checkCall("_onApiTrackError")){var e=this._getPlayhead();if(null!=e&&!isNaN(e)){var i=t.data;if(this.log("#_onApiTrackError(source="+i[N.SOURCE]+", err_id="+i[N.ERROR_ID]+")"),this._trackExternalErrors||i[N.SOURCE]===b){var a=this;this._deferred=function(t){var n=t[N.TIMER_INTERVAL];a._updateQoSInfo();var s=new u(a._assetData,a._userData,a._streamData,a._qosData,O.EVENT_TYPE_ERROR,e);s.prevItemOfSameType=a._history.getPreviousItemOfSameTypeWith(s),a._history.updateWith(s);var r=a._reporterHelper.createReportForItem(s,n),o=r.reportEntries[0];o.eventData.id(i[N.ERROR_ID]),o.eventData.source(i[N.SOURCE]);var h={};h[N.REPORT]=r,a._commCenter.notificationCenter.dispatchEvent(new R(R.CONTEXT_DATA_AVAILABLE,h))};var n={};n[N.WHAT]=S.keys.TRACKING_TIMER_INTERVAL,this._commCenter.notificationCenter.dispatchEvent(new S(S.DATA_REQUEST,n))}}}},n.prototype._onClockTrackingTick=function(t){if(this._checkCall("_onClockTrackingTick")){var e=t.data[N.TIMER_INTERVAL];this.log("#_onClockTrackingTick(interval="+e+")");var i=this._getMainVideoPlayhead();if(null!=i&&!isNaN(i)){var a=this._getPlayhead();if(null!=a&&!isNaN(a)){var n=new v(this._assetData);n.adData(null),n.type(this._videoAssetType),this._updateQoSInfo();var s=new u(n,this._userData,this._streamData,this._qosData,O.EVENT_TYPE_ACTIVE,i);s.prevItemOfSameType=this._history.getPreviousItemOfSameTypeWith(s),this._placeItemOnTimeline(s,a);var r=this._reporterHelper.createReportForQuantum(e),o={};o[N.REPORT]=r,this._commCenter.notificationCenter.dispatchEvent(new R(R.CONTEXT_DATA_AVAILABLE,o))}}}},n.prototype._onNetworkCheckStatusComplete=function(t){this._trackExternalErrors=t.data[N.TRACK_EXTERNAL_ERRORS],this.log("#_onNetworkCheckStatusComplete(track_ext_err="+this._trackExternalErrors+")")},n.prototype._onDataRequest=function(t){var e=t.data[N.WHAT];switch(this.log("#_onDataRequest(what="+e+")"),e){case S.keys.MAIN_VIDEO_PUBLISHER:var i={};i[N.PUBLISHER]=this._configData.publisher,this._commCenter.notificationCenter.dispatchEvent(new S(S.DATA_RESPONSE,i))
}},n.prototype._onDataResponse=function(t){this.log("#_onDataResponse()"),this.executeDeferred(t.data)},n.prototype._installEventListeners=function(){this._commCenter.notificationCenter.addEventListener(k.API_CONFIG,this._onApiConfig,this),this._commCenter.notificationCenter.addEventListener(k.API_VIDEO_LOAD,this._onApiVideoLoad,this),this._commCenter.notificationCenter.addEventListener(k.API_VIDEO_UNLOAD,this._onApiVideoUnload,this),this._commCenter.notificationCenter.addEventListener(k.API_VIDEO_START,this._onApiVideoStart,this),this._commCenter.notificationCenter.addEventListener(k.API_VIDEO_COMPLETE,this._onApiVideoComplete,this),this._commCenter.notificationCenter.addEventListener(k.API_AD_START,this._onApiAdStart,this),this._commCenter.notificationCenter.addEventListener(k.API_AD_COMPLETE,this._onApiAdComplete,this),this._commCenter.notificationCenter.addEventListener(k.API_PLAY,this._onApiPlay,this),this._commCenter.notificationCenter.addEventListener(k.API_PAUSE,this._onApiPause,this),this._commCenter.notificationCenter.addEventListener(k.API_BUFFER_START,this._onApiBufferStart,this),this._commCenter.notificationCenter.addEventListener(k.API_SEEK_START,this._onApiSeekStart,this),this._commCenter.notificationCenter.addEventListener(k.API_SEEK_COMPLETE,this._onApiSeekComplete,this),this._commCenter.notificationCenter.addEventListener(k.API_CHAPTER_START,this._onApiChapterStart,this),this._commCenter.notificationCenter.addEventListener(k.API_CHAPTER_COMPLETE,this._onApiChapterComplete,this),this._commCenter.notificationCenter.addEventListener(k.API_BITRATE_CHANGE,this._onApiBitrateChange,this),this._commCenter.notificationCenter.addEventListener(k.API_TRACK_ERROR,this._onApiTrackError,this),this._commCenter.notificationCenter.addEventListener(D.CLOCK_TRACKING_TICK,this._onClockTrackingTick,this),this._commCenter.notificationCenter.addEventListener(I.NETWORK_CHECK_STATUS_COMPLETE,this._onNetworkCheckStatusComplete,this),this._commCenter.notificationCenter.addEventListener(S.DATA_REQUEST,this._onDataRequest,this),this._commCenter.notificationCenter.addEventListener(S.DATA_RESPONSE,this._onDataResponse,this)},n.prototype._uninstallEventListeners=function(){this._commCenter.notificationCenter.removeAllListeners(this)},n.prototype._resetInternalState=function(){this.log("#_resetInternalState()"),this._isTrackingSessionActive=!1,this._isVideoComplete=!1,this._videoAssetType=null,this._counters=new y,this._history=new d,this._timeline=new p(this),this._userData=new T,this._streamData=new C,this._qosData=new A,this._sessionData=new m,this._assetData=new v,this._assetData.publisher(this._configData.publisher),this._stashedAdData=null,this._stashedChapterData=null},n.prototype._placeItemOnTimeline=function(t,e){this.log("#_placeItemOnTimeline(type="+t.eventType+")"),this._timeline.addItem(t,e),this._history.updateWith(t)},n.prototype._getPlayhead=function(){var t=null;if(this._assetData.adData()){var e=this._playerDelegate.getAdInfo();e&&this._inputDataSanitizer.sanitizeAdInfo(e,!1)&&(t=e.playhead)}else{var i=this._playerDelegate.getVideoInfo();this._inputDataSanitizer.sanitizeVideoInfo(i)&&(t=i.playhead)}return t},n.prototype._getMainVideoPlayhead=function(){var t=null,e=this._playerDelegate.getVideoInfo();return this._inputDataSanitizer.sanitizeVideoInfo(e)&&(t=e.playhead),t},n.prototype._updateQoSInfo=function(){var t=this._playerDelegate.getQoSInfo();this._qosData.bitrate(t&&!isNaN(t.bitrate)?t.bitrate:0),this._qosData.fps(t&&!isNaN(t.fps)?t.fps:0),this._qosData.droppedFrames(t&&!isNaN(t.droppedFrames)?t.droppedFrames:0)},n.prototype._checkCall=function(t){return this._isTrackingSessionActive?this._isVideoComplete?(this.warn("#"+t+"() > The video content already completed."),!1):!0:(this.warn("#"+t+"() > No active tracking session."),!1)},n.prototype._executeErrorCallback=function(t,e){var i={};i[N.MESSAGE]=t,i[N.DETAILS]=e,this._commCenter.notificationCenter.dispatchEvent(new ErrorEvent(ErrorEvent.ERROR,i))},e.context.Context=n}(a,n,i,e),function(t){function e(){"use strict";this.account=null,this.trackingServer=null,this.ssl=!1}t.AppMeasurementInfo=e}(n),function(t,e){"use strict";function i(t,e){this._visitorApiInfo=null,this._clock=null,this._context=null,this._network=null,this._isDestroyed=!1,this._commCenter=new o,this._playerDelegate=t,this._errorOperation=e,this._isConfigured=!1,this._bootstrap(),this.enableLogging("[heartbeat::Heartbeat] > ")}var a="primetime",n=t.mixin,s=t.logger,r=t.Operation,o=t.CommCenter,h=e.event.EventKeyName,_=e.event.ApiEvent,c=e.clock.Clock,l=e.network.Network,p=e.context.Context,u=e.model.QuerystringSerializer;n(i,s),i.prototype.configure=function(t,e,i){if(!t)throw Error("AppMeasurement info object cannot be NULL");if(!e)throw Error("VisitorAPI info object cannot be NULL");if(this._visitorApiInfo=e,!i)throw Error("Configuration object cannot be NULL");var n=i.__primetime?a:i.ovp,s=i.__psdkVersion||i.sdk,r=i.trackingServer+"/settings/";this.log("#setup() > Applying configuration: {account: "+t.account+", scTrackingServer: "+t.trackingServer+", sbTrackingServer: "+i.trackingServer+", jobId: "+i.jobId+", publisher: "+i.publisher+", ovp: "+i.ovp+", sdk: "+i.sdk+", useSSL: "+t.ssl+", quietMode:  "+i.quietMode+", channel:"+i.channel+", debugLogging: "+i.debugLogging+"}");var o={};o[h.ACCOUNT]=t.account,o[h.SC_TRACKING_SERVER]=t.trackingServer,o[h.TRACKING_SERVER]=i.trackingServer,o[h.CHECK_STATUS_SERVER]=r,o[h.JOB_ID]=i.jobId,o[h.PUBLISHER]=i.publisher,o[h.OVP]=n,o[h.SDK]=s,o[h.USE_SSL]=t.ssl,o[h.CHANNEL]=i.channel,o[h.QUIET_MODE]=i.quietMode,this._commCenter.notificationCenter.dispatchEvent(new _(_.API_CONFIG,o)),this._isConfigured=!0},i.prototype.destroy=function(){this._isDestroyed||(this._isDestroyed=!0,this.log("#destroy()"),this._commCenter.workQueue.cancelAllOperations(),this._commCenter.notificationCenter.removeAllListeners(this),this._network.destroy(),this._context.destroy(),this._clock.destroy())},i.prototype.videoLoad=function(t){if(this.log("#videoLoad(playerName="+t.playerName+", id="+t.id+", name="+t.name+", length="+t.length+", playhead="+t.playhead+", streamType="+t.streamType+")"),this._canTrack()){var e=new r(function(){var e={};e[h.ANALYTICS_VISITOR_ID]=this._visitorApiInfo.analyticsVisitorID,e[h.MARKETING_CLOUD_VISITOR_ID]=this._visitorApiInfo.marketingCloudVisitorID,e[h.VISITOR_ID]=this._visitorApiInfo.visitorID,e[h.VIDEO_INFO]=t,this._commCenter.notificationCenter.dispatchEvent(new _(_.API_VIDEO_LOAD,e))},this);this._commCenter.workQueue.addOperation(e)}},i.prototype.videoUnload=function(){if(this.log("#videounload()"),this._canTrack()){var t=new r(function(){this._commCenter.notificationCenter.dispatchEvent(new _(_.API_VIDEO_UNLOAD))},this);this._commCenter.workQueue.addOperation(t)}},i.prototype.videoStart=function(){if(this.log("#videoStart()"),this._canTrack()){var t=new r(function(){this._commCenter.notificationCenter.dispatchEvent(new _(_.API_VIDEO_START))},this);this._commCenter.workQueue.addOperation(t)}},i.prototype.videoComplete=function(){if(this.log("#videoComplete()"),this._canTrack()){var t=new r(function(){this._commCenter.notificationCenter.dispatchEvent(new _(_.API_VIDEO_COMPLETE))},this);this._commCenter.workQueue.addOperation(t)}},i.prototype.play=function(){if(this.log("#play()"),this._canTrack()){var t=new r(function(){this._commCenter.notificationCenter.dispatchEvent(new _(_.API_PLAY))},this);this._commCenter.workQueue.addOperation(t)}},i.prototype.pause=function(){if(this.log("#pause()"),this._canTrack()){var t=new r(function(){this._commCenter.notificationCenter.dispatchEvent(new _(_.API_PAUSE))},this);this._commCenter.workQueue.addOperation(t)}},i.prototype.bufferStart=function(){if(this.log("#bufferStart()"),this._canTrack()){var t=new r(function(){this._commCenter.notificationCenter.dispatchEvent(new _(_.API_BUFFER_START))},this);this._commCenter.workQueue.addOperation(t)}},i.prototype.seekStart=function(){if(this.log("#seekStart()"),this._canTrack()){var t=new r(function(){this._commCenter.notificationCenter.dispatchEvent(new _(_.API_SEEK_START))},this);this._commCenter.workQueue.addOperation(t)}},i.prototype.seekComplete=function(){if(this.log("#seekComplete()"),this._canTrack()){var t=new r(function(){this._commCenter.notificationCenter.dispatchEvent(new _(_.API_SEEK_COMPLETE))},this);this._commCenter.workQueue.addOperation(t)}},i.prototype.adStart=function(t,e){if(this.log("#adStart(id="+t.id+", name="+t.name+", length="+t.length+", playhead="+t.playhead+", position="+t.position+", cpm="+t.cpm+", podPlayerName="+e.playerName+", podName="+e.name+", podIndex="+e.position+", podOffset="+e.startTime+")"),this._canTrack()){var i=new r(function(){var i={};i[h.AD_INFO]=t,i[h.AD_BREAK_INFO]=e,this._commCenter.notificationCenter.dispatchEvent(new _(_.API_AD_START,i))},this);this._commCenter.workQueue.addOperation(i)}},i.prototype.adComplete=function(){if(this.log("#adComplete()"),this._canTrack()){var t=new r(function(){this._commCenter.notificationCenter.dispatchEvent(new _(_.API_AD_COMPLETE))},this);this._commCenter.workQueue.addOperation(t)}},i.prototype.chapterStart=function(t){if(this.log("#chapterStart()"),this._canTrack()){var e=new r(function(){var e={};e[h.CHAPTER_INFO]=t,this._commCenter.notificationCenter.dispatchEvent(new _(_.API_CHAPTER_START,e))},this);this._commCenter.workQueue.addOperation(e)}},i.prototype.chapterComplete=function(){if(this.log("#chapterComplete()"),this._canTrack()){var t=new r(function(){this._commCenter.notificationCenter.dispatchEvent(new _(_.API_CHAPTER_COMPLETE))},this);this._commCenter.workQueue.addOperation(t)}},i.prototype.bitrateChange=function(){if(this.log("#bitrateChange()"),this._canTrack()){var t=new r(function(){this._commCenter.notificationCenter.dispatchEvent(new _(_.API_BITRATE_CHANGE))},this);this._commCenter.workQueue.addOperation(t)}},i.prototype.trackError=function(t,e){if(this.log("#trackError(source="+t+", errorId="+e+")"),this._canTrack()){var i=new r(function(){var i={};i[h.SOURCE]=t,i[h.ERROR_ID]=e,this._commCenter.notificationCenter.dispatchEvent(new _(_.API_TRACK_ERROR,i))},this);this._commCenter.workQueue.addOperation(i)}},i.prototype._onHeartbeatError=function(t){this._errorOperation.params=[t.data[h.MESSAGE],t.data[h.DETAILS]],this._errorOperation.run()},i.prototype._bootstrap=function(){this._initSubmodules(),this._commCenter.notificationCenter.addEventListener(ErrorEvent.ERROR,this._onHeartbeatError,this)},i.prototype._initSubmodules=function(){this._context=new p(this._commCenter,this._playerDelegate),this._clock=new c(this._commCenter),this._network=new l(this._commCenter,new u,this._playerDelegate)},i.prototype._canTrack=function(){var t=this._visitorApiInfo.analyticsVisitorID,e=this._visitorApiInfo.marketingCloudVisitorID,i=this._isConfigured&&(t||e);return i||this.warn("_canTrack() > Unable to track! Is configured: "+this._isConfigured+", analyticsVisitorID: "+t+", marketingCloudVisitorID: "+e),i},e.Heartbeat=i}(a,n),function(t){"use strict";function e(){this.analyticsVisitorID=null,this.marketingCloudVisitorID=null,this.visitorID=null}t.VisitorApiInfo=e}(n),function(t,e,i,a){"use strict";function n(t,e){if(n.__super__.constructor.call(this),this._configData=null,this._isTrackingSessionActive=!1,this._isPaused=!1,this._isSeeking=!1,this._isBuffering=!1,this._errorInfo=null,this._readyToTrack=!1,!t)throw Error("The reference to the AppMeasurement object cannot be NULL.");if(this._appMeasurement=t,this._appMeasurementInfo=new u,this._appMeasurementInfo.account=this._appMeasurement.account,this._appMeasurementInfo.ssl=this._appMeasurement.ssl,this._appMeasurementInfo.trackingServer=this._appMeasurement.ssl&&this._appMeasurement.trackingServerSecure?this._appMeasurement.trackingServerSecure:this._appMeasurement.trackingServer,this._visitorApiInfo=new d,!e)throw Error("The reference to the PlayerDelegate implementation cannot be NULL.");this._playerDelegate=e;var i=new _(this._executeErrorCallback,this);this._inputDataSanitizer=new c(i),this._heartbeat=new m(this._playerDelegate,i),this._resetInternalState(),this._isDestroyed=!1,this.enableLogging("[video-heartbeat::VideoHeartbeat] > "),this._hbWorkQueue=new h,this._scWorkQueue=new h(2e3),this._prepareAppMeasurement()}var s=t.extend,r=t.logger,o=t.mixin,h=t.WorkQueue,_=t.Operation,c=t.InputDataSanitizer,l=e.HeartbeatProtocol,p=e.ErrorInfo,u=i.AppMeasurementInfo,d=i.VisitorApiInfo,m=i.Heartbeat,f=a.md5,v="application",E="player",T="video",C="videoAd",A="ms_s",g="msp_s",y="msa_s",D="mspa_s";s(n,l),o(n,r),n.prototype.configure=function(e){if(!e)throw Error("Configuration object cannot be NULL");this._configData=e,t.LOGGING_ENABLED=!!e.debugLogging,this.log("#config({, trackingServer="+e.trackingServer+", jobId="+e.jobId+", publisher="+e.publisher+", ovp="+e.ovp+", sdk="+e.sdk+", __primetime="+e.__primetime+", __psdkVersion="+e.__psdkVersion+", useSSL="+this._appMeasurement.ssl+", quietMode="+e.quietMode+", channel="+e.channel+", debugLogging="+e.debugLogging+"})"),this._enqueueCall(this._hbWorkQueue,"heartbeat.configure",this._heartbeat.configure,[this._appMeasurementInfo,this._visitorApiInfo,e])},n.prototype.destroy=function(){this._isDestroyed||(this._heartbeat.destroy(),this._isDestroyed=!0)},n.prototype.trackVideoLoad=function(){if(this._isDestroyed)return this.warn("#trackVideoLoad() > Unable to track: instance previously destroyed."),this._executeErrorCallback("Illegal operation.","Instance previously destroyed."),void 0;this._isTrackingSessionActive&&this._enqueueCall(this._hbWorkQueue,"heartbeat.videoUnload",this._heartbeat.videoUnload),this._resetInternalState(),this.log("#trackVideoLoad() > Querying the player delegate.");var t=this._playerDelegate.getVideoInfo();this._inputDataSanitizer.sanitizeVideoInfo(t)&&(this.log("#trackVideoLoad(playerName="+t.playerName+", videoId="+t.id+", name="+t.name+", length="+t.length+", playhead="+t.playhead+", streamType="+t.streamType+")"),this._enqueueCall(this._scWorkQueue,"sc.open",this._executeSiteCatalystOpen,[t]),this._enqueueCall(this._hbWorkQueue,"heartbeat.videoLoad",this._heartbeat.videoLoad,[t]),this._enqueueCall(this._hbWorkQueue,"heartbeat.videoStart",this._heartbeat.videoStart),this._isTrackingSessionActive=!0)},n.prototype.trackVideoUnload=function(){this._checkCall("trackVideoUnload")&&(this.log("#trackVideoUnload() > Tracking a VIDEO_UNLOAD event."),this._enqueueCall(this._hbWorkQueue,"heartbeat.videoUnload",this._heartbeat.videoUnload),this._isTrackingSessionActive=!1)},n.prototype.trackPlay=function(){this._checkCall("trackPlay")&&(this.log("#trackPlay() > Tracking a PLAY event."),this._isPaused=!1,this._resumePlaybackIfPossible())},n.prototype.trackPause=function(){this._checkCall("trackPause")&&(this.log("#trackPause() > Tracking a PAUSE event."),this._enqueueCall(this._hbWorkQueue,"heartbeat.pause",this._heartbeat.pause),this._isPaused=!0)},n.prototype.trackBufferStart=function(){this._checkCall("trackBufferStart")&&(this.log("#trackBufferStart() > Tracking a BUFFER_START event."),this._enqueueCall(this._hbWorkQueue,"heartbeat.bufferStart",this._heartbeat.bufferStart),this._isBuffering=!0)},n.prototype.trackBufferComplete=function(){this._checkCall("trackBufferComplete")&&(this.log("#trackBufferComplete() > Tracking a BUFFER_COMPLETE event."),this._isBuffering=!1,this._resumePlaybackIfPossible())},n.prototype.trackSeekStart=function(){this._checkCall("trackSeekStart")&&(this.log("#trackSeekStart() > Tracking a SEEK_START event."),this._enqueueCall(this._hbWorkQueue,"heartbeat.seekStart",this._heartbeat.seekStart),this._enqueueCall(this._hbWorkQueue,"heartbeat.pause",this._heartbeat.pause),this._isSeeking=!0)},n.prototype.trackSeekComplete=function(){this._checkCall("trackSeekComplete")&&(this.log("#trackSeekComplete() > Tracking a SEEK_COMPLETE event."),this._enqueueCall(this._hbWorkQueue,"heartbeat.seekComplete",this._heartbeat.seekComplete),this._isSeeking=!1,this._resumePlaybackIfPossible())},n.prototype.trackComplete=function(){this._checkCall("trackComplete")&&(this.log("#trackComplete() > Tracking a COMPLETE event."),this._enqueueCall(this._hbWorkQueue,"heartbeat.videoComplete",this._heartbeat.videoComplete))},n.prototype.trackAdBreakStart=function(){this.warn("#trackAdBreakStart() > Deprecated.")},n.prototype.trackAdBreakComplete=function(){this.warn("#trackAdBreakComplete() > Deprecated.")},n.prototype.trackAdStart=function(){if(this._checkCall("trackAdStart")){this.log("#trackAdStart() > Querying the player delegate.");var t=this._playerDelegate.getVideoInfo();if(this._inputDataSanitizer.sanitizeVideoInfo(t)){var e=this._playerDelegate.getAdBreakInfo();if(this._inputDataSanitizer.sanitizeAdBreakInfo(e,!1)){(null==e.startTime||isNaN(e.startTime))&&(e.startTime=t.playhead);var i=this._playerDelegate.getAdInfo();this._inputDataSanitizer.sanitizeAdInfo(i,!1)&&(this.log("#trackAdStart(adId="+i.id+", name="+i.name+", length="+i.length+", playhead="+i.playhead+", position="+i.position+", cpm="+i.cpm+")"),this._enqueueCall(this._scWorkQueue,"sc.openAd",this._executeSiteCatalystOpenAd,[t,e,i]),this._enqueueCall(this._hbWorkQueue,"heartbeat.adStart",this._heartbeat.adStart,[i,e]),this._resumePlaybackIfPossible())}}}},n.prototype.trackAdComplete=function(){this._checkCall("trackAdComplete")&&(this.log("#trackAdComplete() > Tracking an AD_COMPLETE event."),this._enqueueCall(this._hbWorkQueue,"heartbeat.adComplete",this._heartbeat.adComplete),this._resumePlaybackIfPossible())},n.prototype.trackChapterStart=function(){if(this._checkCall("trackChapterStart")){this.log("#trackChapterStart() > Querying the player delegate.");var t=this._playerDelegate.getChapterInfo();this._inputDataSanitizer.sanitizeChapterInfo(t,!1)&&(this.log("#trackChapterStart(name="+t.name+", length="+t.length+", position="+t.position+", startTime="+t.startTime+")"),this._enqueueCall(this._hbWorkQueue,"heartbeat.chapterStart",this._heartbeat.chapterStart,[t]),this._resumePlaybackIfPossible())}},n.prototype.trackChapterComplete=function(){this._checkCall("trackChapterComplete")&&(this.log("#trackChapterComplete() > Tracking a CHAPTER_COMPLETE event."),this._enqueueCall(this._hbWorkQueue,"heartbeat.chapterComplete",this._heartbeat.chapterComplete),this._resumePlaybackIfPossible())},n.prototype.trackBitrateChange=function(){this._checkCall("trackBitrateChange")&&this._enqueueCall(this._hbWorkQueue,"heartbeat.bitrateChange",this._heartbeat.bitrateChange)},n.prototype.trackVideoPlayerError=function(t){this._checkCall("trackVideoPlayerError")&&(this.log("#trackVideoPlayerError(errorId="+t+")."),this._enqueueCall(this._hbWorkQueue,"heartbeat.trackError",this._heartbeat.trackError,[E,t]))},n.prototype.trackApplicationError=function(t){this._checkCall("trackApplicationError")&&(this.log("#trackApplicationError(errorId="+t+")."),this._enqueueCall(this._hbWorkQueue,"heartbeat.trackError",this._heartbeat.trackError,[v,t]))},n.prototype._checkCall=function(t){return this._errorInfo?(this.warn("#"+t+"() > Unable to track: in ERROR state. "+"Message: "+this._errorInfo.message+" | Details: "+this._errorInfo.details),!1):this._isDestroyed?(this.warn("#"+t+"() > Unable to track: instance previously destroyed."),this._executeErrorCallback("Illegal operation.","Instance previously destroyed."),!1):this._isTrackingSessionActive?!0:(this.warn("#"+t+"() > Unable to track: no active tracking session."),!1)},n.prototype._resumePlaybackIfPossible=function(){this._isPaused||this._isSeeking||this._isBuffering||this._enqueueCall(this._hbWorkQueue,"heartbeat.play",this._heartbeat.play)},n.prototype._executeSiteCatalystOpen=function(t){this.log(this,"#_executeSiteCatalystOpen(id="+t.id+", length="+t.length+", streamType="+t.streamType+", playerName="+t.playerName+")"),this._resetAppMeasurementContextData(),this._appMeasurement.contextData["a.contentType"]=T,this._appMeasurement.contextData["a.media.name"]=t.id,this._appMeasurement.contextData["a.media.friendlyName"]=t.name||"",this._appMeasurement.contextData["a.media.length"]=Math.floor(t.length),this._appMeasurement.contextData["a.media.playerName"]=t.playerName,this._appMeasurement.contextData["a.media.channel"]=this._configData.channel,this._appMeasurement.contextData["a.media.view"]=!0,this._appMeasurement.pev3=T,this._appMeasurement.pe=this._configData.__primetime?g:A,this._appMeasurement.track()},n.prototype._executeSiteCatalystOpenAd=function(t,e,i){var a=f(t.id)+"_"+e.position;this.log("#_executeSiteCatalystOpenAd(id="+i.id+", length="+i.length+", playerName="+e.playerName+", parentId="+t.id+", podId="+a+", parentPodPosition="+i.position+", podSecond="+e.startTime+", cpm="+i.cpm+")"),this._resetAppMeasurementContextData(),this._appMeasurement.contextData["a.contentType"]=C,this._appMeasurement.contextData["a.media.name"]=t.id,this._appMeasurement.contextData["a.media.channel"]=this._configData.channel,this._appMeasurement.contextData["a.media.ad.name"]=i.id,this._appMeasurement.contextData["a.media.ad.friendlyName"]=i.name||"",this._appMeasurement.contextData["a.media.ad.podFriendlyName"]=e.name||"",this._appMeasurement.contextData["a.media.ad.length"]=Math.floor(i.length),this._appMeasurement.contextData["a.media.ad.playerName"]=e.playerName,this._appMeasurement.contextData["a.media.ad.pod"]=a,this._appMeasurement.contextData["a.media.ad.podPosition"]=Math.floor(i.position),this._appMeasurement.contextData["a.media.ad.podSecond"]=Math.floor(e.startTime),this._appMeasurement.contextData["a.media.ad.CPM"]=i.cpm,this._appMeasurement.contextData["a.media.ad.view"]=!0,this._appMeasurement.pev3=C,this._appMeasurement.pe=this._configData.__primetime?D:y,this._appMeasurement.track()},n.prototype._resetInternalState=function(){this.log("#_resetInternalState() : Resetting internal state variables."),this._errorInfo=null,this._isTrackingSessionActive=!1,this._isPaused=!1,this._isSeeking=!1,this._isBuffering=!1},n.prototype._enqueueCall=function(t,e,i,a){if(this._errorInfo)return this.warn("#_enqueueHeartbeatCall() > Unable to track: in ERROR state."),void 0;a=a!==void 0?a:null;var n=t==this._hbWorkQueue?this._heartbeat:this;this._readyToTrack?t.isEmpty()?t==this._hbWorkQueue?i.apply(n,a):(this._scWorkQueue.addJob(e,i,a,this),this._scWorkQueue.drain()):(this.log("#_enqueueCall() : "+e),t.addJob(e,i,a,n)):(this.log("#_enqueueCall() : "+e),t.addJob(e,i,a,n))},n.prototype._prepareAppMeasurement=function(){this._appMeasurement.isReadyToTrack()?this._onAppMeasurementReady():this._appMeasurement.callbackWhenReadyToTrack(this,this._onAppMeasurementReady)},n.prototype._onAppMeasurementReady=function(){return this._errorInfo?(this.log("#_onAppMeasurementReady() > Unable to track: in ERROR state."),this._scWorkQueue.clear(),this._hbWorkQueue.clear(),void 0):(this._visitorApiInfo.analyticsVisitorID=this._appMeasurement.analyticsVisitorID,this._visitorApiInfo.marketingCloudVisitorID=this._appMeasurement.marketingCloudVisitorID,this._visitorApiInfo.visitorID=this._appMeasurement.visitorID,this._readyToTrack=!0,this._scWorkQueue.drain(),this._hbWorkQueue.flush(),void 0)},n.prototype._executeErrorCallback=function(t,e){this.error("#_executeErrorCallback() > "+t+" - "+e),this._errorInfo=new p(t,e),this._playerDelegate.onError(this._errorInfo)},n.prototype._resetAppMeasurementContextData=function(){delete this._appMeasurement.contextData["a.contentType"],delete this._appMeasurement.contextData["a.media.name"],delete this._appMeasurement.contextData["a.media.friendlyName"],delete this._appMeasurement.contextData["a.media.length"],delete this._appMeasurement.contextData["a.media.playerName"],delete this._appMeasurement.contextData["a.media.channel"],delete this._appMeasurement.contextData["a.media.view"],delete this._appMeasurement.contextData["a.media.ad.name"],delete this._appMeasurement.contextData["a.media.ad.friendlyName"],delete this._appMeasurement.contextData["a.media.ad.podFriendlyName"],delete this._appMeasurement.contextData["a.media.ad.length"],delete this._appMeasurement.contextData["a.media.ad.playerName"],delete this._appMeasurement.contextData["a.media.ad.pod"],delete this._appMeasurement.contextData["a.media.ad.podPosition"],delete this._appMeasurement.contextData["a.media.ad.podSecond"],delete this._appMeasurement.contextData["a.media.ad.CPM"],delete this._appMeasurement.contextData["a.media.ad.view"]},e.VideoHeartbeat=n}(a,i,n,e),t.ADB||(t.ADB={}),t.ADB.core||(t.ADB.core=a),t.ADB.va=i})(this);